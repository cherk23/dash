/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(l){var a,t,o;window.rusage_highlight={};var c={},e={};function r(s,n){l.each(n,function(n,i){c[s][i]=!0}),inc_use_graph_loading();var i={f:"netruseblocks",csid:s,csrid:n.join(" "),ssid:Mkiconf.ssid_number,t0:Mkiconf.t0,t1:Mkiconf.t1},o=Mkiconf.node_json_url;Mkijson.n.all.rusage_src&&(i.src=_.map(n,function(n){return Mkijson.n.all.rusage_src[s][n]}).join(" "),o=url_for({controller:"usage",action:"rule_useblocks"})),l.ajax({url:o,dataType:"jsonp",jsonp:"jsonp",success:u,data:i,complete:function(){l.each(n,function(n,i){c[s][i]=!1})}})}function u(n){l.each(n.allnode.nruseblocks,function(n,i){l.extend(Mkijson.n.all.nruseblocks[n],i)}),dec_use_graph_loading(),graph_network_use(!0)}function h(){show3_rule({csid:a,csrid:t,clientid:o})}function g(s,o,n){l.each(n,function(n,i){e[s][o][i]=!0}),inc_use_graph_loading(),l.ajax({url:Mkiconf.client_json_url,dataType:"jsonp",jsonp:"jsonp",success:i,data:{f:"cruseblocks",csid:s,csrid:o,ids:n.join(" "),ssid:Mkiconf.ssid_number,t0:Mkiconf.t0,t1:Mkiconf.t1},complete:function(){l.each(n,function(n,i){e[s][o][i]=!1})}})}function i(n){l.each(n.allclient.cruseblocks,function(s,n){l.each(n,function(n,i){l.extend(Mkijson.c.all.cruseblocks[s][n],i)})}),dec_use_graph_loading(),h()}rusage_highlight.enabled=!1,rusage_highlight.init=function(){var n,i;Mkijson.n.all.nruseblocks={},Mkijson.c.all.cruseblocks={},Mkiconf.counter_set_ids&&l.each(Mkiconf.counter_set_ids,function(n,i){Mkijson.n.all.nruseblocks[i]={},c[i]={}}),Mkiconf.counter_set_id&&Mkiconf.rule_id&&Mkiconf.top_clients_by_usage&&(n=Mkiconf.counter_set_id,i=Mkiconf.rule_id,e[n]={},e[n][i]={},Mkijson.c.all.cruseblocks[n]={},Mkijson.c.all.cruseblocks[n][i]={},g(n,i,_.values(Mkiconf.top_clients_by_usage)))},rusage_highlight.mkigraph_plugin=function(n,i,s,o){var c,e;rusage_highlight.enabled&&Mkijson.n.all.nruseblocks&&a&&t&&((c=Mkijson.n.all.nruseblocks[a][t])&&(e=s.xaxis.min/1e3,s=s.xaxis.max/1e3,e=useblocks_graphseries(c,e,s,[0,0]),(s=l.color.parse("catchall"==t?"#bebec6":Mkiconf.counter_sets[a].rules[t].gcolor)).saturation()<150&&(s=s.saturate(150-s.saturation())),i.push({data:e,color:s.toString(),lines:{fill:!0,fillColor:s.desaturate(40).toString()}})))},rusage_highlight.highlight_rule=function(n,i,s){if(rusage_highlight.enabled&&(n!=a||i!=t)&&(a=n,"catchall"!=(t=i)))return!n||!i||Mkijson.n.all.nruseblocks[n][i]?graph_network_use(!0):void(c[n][i]||(0<=l.inArray(i,Mkiconf.top_rules[n])?r(n,Mkiconf.top_rules[n]):r(n,[i])))},rusage_highlight.highlight_client=function(n,i,s){if(rusage_highlight.enabled&&(n!=a||i!=t||s!=o))return t=i,o=s,!((a=n)&&i&&s)||Mkijson.c.all.cruseblocks[n][i][s]?h():void(e[a][t][o]||g(n,i,[s]))}}(jQuery);