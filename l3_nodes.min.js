/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
Mkiconf=window.Mkiconf||{};var node_load_xhr,l3_nodes={};function show_list(e){if($j("#detail_area").hide(),$j(".place_hide").show(),$j(".place_show").hide(),$j(".map_only").hide(),$j(".list_only").show(),$j("#table_area").show().removeClass("m3 sh3").addClass("l3"),$j("h1").html(Mkiconf.devices_noun_plural_cap),flex_table)return"undefined"!=typeof static_widget&&static_widget.setNodes(flex_table.checked_items()),void(e&&e());node_list3_load(),e&&e()}function show_node(e,t){$j("#table_area").hide(),window.scrollTo(0,0),$j("#detail_area").html($j.ajaxui.thin_indicator().css("margin-top","10px")).show(),node_load_xhr&&node_load_xhr.abort(),node_load_xhr=$j.ajax({url:url_for({controller:"nodes",action:"show",id:e,m:1}),success:function(e){var t;e&&0<e.length&&(e.match(/^redirect_to:/)?(t=e.match(/^redirect_to:(.*)/)[1],window.location.replace(t)):($j("#detail_area").html(e),"undefined"!=typeof static_widget&&static_widget.setNodes([s3node]),"undefined"!=typeof static6_widget&&static6_widget.setNodes([s3node])))},complete:function(){node_load_xhr=null,node_refresh_detail_status(e),t&&t()}}),node_refresh_detail_status(e)}function node_refresh_detail_status(a){var n,r,e=flex_table?flex_table.items():flex_sort(Mkijson.n.hash,node_list3_load.table_options.columns,"name",!1);_.any(e,function(e,t){if(e.id==a)return r=e,n=t,!0}),r&&($j("#detail_header .s3status").html(node3_render_status(r)),$j("#detail_header .s3name").html(r.name||r.mac||"(unknown)"),$j("#prev_ap").attr("href","#n="+(e[n-1]||{}).id).toggle(0<n),$j("#next_ap").attr("href","#n="+(e[n+1]||{}).id).toggle(n<e.length-1),$j("#prev_ap").next(".barsep").toggle(0<n&&n<e.length-1))}function node3_match_loadable(r,s){return function(e,t,a,n){return nodes_meta.hasOwnProperty(r)?s(e,t,a,n):(data3_load.mark_unready(t,"n",r),"false")}}function make_mki_nodes_filter(e){var r,s={mini:"Mini",id2:"Indoor",od1:"Outdoor",od2:"Outdoor",od3:"MR58",wpg:"Wallplug",sol:"Solar",mo1:"MR58",buck:"MX60",buckw:"MX60W",kingpin:"MX64",kingpinw:"MX64W",alamo:"MX65",alamow:"MX65",full:"MX80",poca:"MX84",tink:"MX100",mothra:"MX400",gojira:"MX600",itchy:"MV21",scratchy:"MV71",pleakleyw:"MV12W",pleakleywe:"MV12WE",pleakleyn:"MV12N",sauron:"MV22",sauronx:"MV22X",fury:"MV32",leela:"MV72",leelax:"MV72X",big_boss:"MV13",kang:"MV23",probius:"MV33",mike_wazowski:"MV63",mike_wazowskix:"MV63X",kodos:"MV73",starro:"MV93",starrox:"MV93X",gluon:"Z1"},t={mini:/^MINI(?!-OD)/,indoor:/^ID2/,wallplug:/^WPG/,outdoor:/^(?:MINI-OD|OD2)/,solar:/^SOL/,other:/^(?!ID2|MINI|MR1[12468]|MR2[46]|MR30H|MR3[234]|MR42|MR5[238]|MR6[26]|MR72|OD2|OD3|SOL|WPG)/,od1:/^MINI-OD/,mr58:/^(?:OD3|MR58)/,mv2:/^MV2-HW/,mv12w:/^MV12W-HW/,mv12we:/^MV12WE-HW/,mv12n:/^MV12N-HW/,mv21:/^MV21/,mv22:/^MV22-HW/,mv22x:/^MV22X-HW/,mv32:/^MV32-HW/,mv52:/^MV52-HW/,mv71:/^MV71-HW/,mv72:/^MV72-HW/,mv72x:/^MV72X-HW/,mv13:/^MV13-HW/,mv23:/^MV23-HW/,mv33:/^MV33-HW/,mv63:/^MV63-HW/,mv63x:/^MV63X-HW/,mv73:/^MV73-HW/,mv93:/^MV93-HW/,mv93x:/^MV93X-HW/},o={gw:"x.is_gateway",gateway:"x.is_gateway",rep:"!x.is_gateway",repeater:"!x.is_gateway",active:"S<2",on:"S<2",live:"S<2",alive:"S<2",reachable:"S<2",up:"S<2",online:"S<2",inactive:"S>1",off:"S>1",dead:"S>1",unreachable:"S>1",down:"S>1",offline:"S>1",dormant:"S==3",unseen:"S==4",alerting:"x.alerting",any:"true",true:"true",migration_eligible:"x.catalyst_conversion && x.catalyst_conversion.eligible"},i={alert:u(!0),noalert:u(!1),scanning_radio:"x.has_scanning_radio",eco:"x.eco == 1",fw_mismatch:"x.firmware_mismatch == 1"},l={alert:"!x.alerting"},d=make_smart_filter();if(_.isArray(e))for(var a=_.compact(e),n=0;n<a.length;n++){var c=a[n];s[c]=c.toUpperCase(),t[c]=new RegExp("^"+c.toUpperCase()+"-"),o[c]="D"}function u(e){return"((x['mtun_gws_cache'] != undefined) ? (org_overview_data.get_device_status(x) "+(e?"==1":"!=1")+") : "+(e?"":"!")+"x.alerting)"}function h(e,t,a){var n,r;if("+"===e.charAt(1)||"-"===e.charAt(1)){for(n=e.substr(2).split(","),r=0;r<n.length;++r)n[r]=t+(a?"==='"+n[r]+"'":"=="+n[r]);return"+"===e.charAt(1)?n.join("||"):"!("+n.join("||")+")"}if(a)return t+"==='"+e.substr(1)+"'";e=e.substr(1);return"(x['mtun_gws_cache'] != undefined) ? (org_overview_data.get_device_status(x)"+e+") : (x['status#']"+e+")"}function p(n){return function(e,t){var a=n[e];if(e=e.replace(/\s+/g,"").toLowerCase(),a){if("D"!==a)return"S"==a.charAt(0)?h(a,"x['status#']",!1):a;t=d.exact_pm("short_description",!1)(e,t),e=e.replace(/[']/g,"");return"x.short_description ? "+t+" : (devre['"+e+"'] && devre['"+e+"'].test(x.model || ''))"}return"false"}}function m(e,t,a,n){return e?n.propmatch("tags"," "+e+" ",t,!1):"false"}function f(e,t,a,n){return"none"==e?p(l)("alert",t,a,n):"any"==e?p(i)("alert",t,a,n):n.propmatch("alert_tags",e,t,!1)}function g(e,t,a,n){var r,s=n.ids(a,e,t),o={};for(r in s)o[nodes_hash[s[r]].gateway_id]=!0;return t.helpers.push(o),"helpers["+(t.helpers.length-1)+"][x.id]"}function v(e,t,a,n){return t.helpers.push(n.ids(a,e,t,"h")),"helpers["+(t.helpers.length-1)+"][x.gateway_id]"}function b(e,t,a,n){var r,s=n.ids(a,e,t),o={};for(r in s)o[nodes_hash[s[r]].gateway_id]=!0;return t.helpers.push(o),"helpers["+(t.helpers.length-1)+"][x.gateway_id]"}function w(e,t,a,n,r){return"name_or_mac"==t?"(x.lldp_info"+e+" ? ("+r.index_of_match("x.lldp_info"+e+".name_or_mac",a,n,!1)+") : false)":"(x.lldp_info"+e+" ? (x.lldp_info"+e+".port_desc ? ("+r.index_of_match("x.lldp_info"+e+".port_desc",a,n,!1)+") : false) : false)"}return b.take_expr=v.take_expr=g.take_expr=!0,d.addmvars({known_device_types:s,devre:t}),d.addkw({"":function(e,t,a,n){var r,s,o,i,_=[n.propmatch("name",e,t),n.propmatch("product_short_description",e,t,!1),n.propmatch("tags",e,t,!1),(o=t,i=n,_=[],s=(s=e).replace(/[_\s\"]/,""),_.push(w(0,"name_or_mac",s,o,i)),_.push(w(1,"name_or_mac",s,o,i)),_.push(w(0,"port_desc",s,o,i)),_.push(w(1,"port_desc",s,o,i)),_.length||_.push("false"),_.join("||")),(o=e,i=t,"(x.network ? "+n.simple_pm("network",!1)(o,i)+" : false)"),(_=t,i=(o="Mkijson.locale.hash[x.locale_id]")+".name",_=n.result_match(i,e,t,!1),"("+["x.locale_id",o,i].join(" && ")+" ? "+_+" : false)")];return e.match(/^[-0-9a-f:.]+$/)&&(r=l3_clean_mac(e,!0))&&_.push(n.propmatch("mac",r,t,!0)),e.match(/^[0-9a-fA-F:]+$/)&&_.push(n.propmatch("ip6",e,t,!0)),e.match(/^(?:\.[\d.]+|\d+\.[\d.]*|\d+\/\d+)(?:\/\d+)?$/)&&_.push(n.getkw("ip")(e,t,a,n)),(e.match(/^[-0-9a-f]{3,11}$/i)||e.match(/^[-2-9A-HJ-NP-Z]{4,14}$/i))&&_.push(match_serial(e,t,a,n)),e.match(/^[-.\w]+$/)&&_.push(f(e,t,a,n)),_.join("||")},is:p(o),has:p(i),no:p(l),device:function(e,t){t=d.exact_pm("short_description",!1)(e,t),e=e.replace(/[']/g,"");return"x.short_description ? "+t+" : (devre['"+e+"'] && devre['"+e+"'].test(x.model || ''))"},status:function(e,t,a,n){return e=e.replace(/"/g,"").replace(/\s+/g,"_"),e=new RegExp("^"+e),"online".match(e)?h(o.online):"offline".match(e)?h(o.offline):"alerting".match(e)?i.alert:"not_alerting".match(e)?i.noalert:void 0},name:function(e,t){return d.propmatch("name",e,t)},mac:function(e,t){return(e=l3_clean_mac(e))?d.propmatch("mac",e,t,!0):"false"},serial:match_serial,ip:make_smart_filter_match_ip("ip","local_ip"),tag:m,alerts:f,label:m,notes:node3_match_loadable(r="notes",function(e,t,a,n){return n.propmatch(r,e,t,!1)}),route:function(e,t,a,n){var r=split_text_comparison(e);return/^\d+$/.test(r[1])?"x['gwhops#']"+r[0]+parseInt(r[1],10):(t.helpers.push(n.ids(a,e,t,"r")),(t="helpers["+(t.helpers.length-1)+"]")+".test(x.id) || "+t+".test(x.gateway_route)")},"gw-for":g,"has-gw":v,"shares-gw":b,usage:smart_filter_match_usage("usage#"),clients:function(e,t,a,n){return e=split_text_comparison(e),/^\d+$/.test(e[1])?"x['clients#']"+e[0]+parseInt(e[1],10):"false"},offline:function(e,t,a,n){return!1!==((e=split_text_comparison(e))[1]=parse_time(e[1],"h"))?"=="===e[0]?"x['outage_graph#']>="+.9*e[1]+"&&x['outage_graph#']<="+1.1*e[1]:"!="===e[0]?"x['outage_graph#']<"+.9*e[1]+"||x['outage_graph#']>"+1.1*e[1]:"x['outage_graph#']"+e[0]+e[1]:"false"},channel:node3_match_loadable("channel",l3_match_channel),supports:function(e,t,a,n){return(e=(e=e.replace(/[\\\"]/g,"")).match(/^([0-9]+)\s*ssids$/i))?"node_product_info(x,'max_ssid',3)>="+(parseInt(e[1],10)-1):"false"}}),d.addkw({"on-map":function(e,t,a,n){e=e.replace(/[\\\"]/g,"");var r={};return"world-map"==e?jQuery.each(Mkijson.n.hash,function(e,t){0==t.lat&&0==t.lng||(r[e]=t)}):r=custom_map_placements(e),t.helpers.push(r||{}),"helpers["+(t.helpers.length-1)+"][x.id]"}}),function(){var e,t,a=[],n={};for(e in s)n[t=s[e]]||(a.push("is:"+t.toLowerCase()),n[t]=!0);a.push("is:other"),d.add_checkbox_partition(a),d.add_checkbox_partition("is:online","is:offline"),d.add_checkbox_partition("has:alert","no:alert"),d.add_checkbox_partition("is:gateway","is:repeater"),d.add_checkbox_partition("tag:airmarshal","-tag:airmarshal")}(),mki_nodes_filter=d}function setup_node_search_filter(e,t){var o,i=make_mki_nodes_filter();n(0,e);var l=new SearchFilter({data:e,filter:i,searchbox:t&&t.searchbox?t.searchbox:void 0});return $(l).on("change:data",n).on("change:results",function(e,t){var a;{var n;o.count!==t.length?(a=pluralized_matches_html(o.count,"match","matches",t.length),"undefined"!=typeof _current_tab&&"device"==_current_tab&&(n=_.pluck(t,"id"),hasReactOrgOverview?window.dispatchFilterAction("device",n):org_overview_map.filter_markers(function(e){return _.contains(n,e.n_id)}))):(a="<b>"+pluralized_phrase(o.count,Mkiconf.devices_noun,Mkiconf.devices_noun_plural)+"</b>","undefined"!=typeof _current_tab&&"device"==_current_tab&&(hasReactOrgOverview?window.dispatchFilterAction("device",null):org_overview_map.reset_markers()))}l.container.siblings(".search_count").html(a)}),$j(document).on("node_change",function(e,t){var a,n;for(a in t)!{id:!0,nuseblocks:!0,cuseblocks:!0}[a]&&(n=!0);n&&l.runNow()}),l;function n(e,t){var n,r,s;t=_.values(t),o={count:(s=t).length,gateway:0,repeater:0,airmarshal:0,min_usage:1/0,max_usage:0,max_ping_latency:0,version:nodes_meta.stats_version,tags:{},channel:{},status:{online:0,offline:0,alerting:0,"not alerting":0},device_type:{}},t1=nodes_meta.upseries,_.each(s,function(e){e.upseries&&e.upseries.length&&node3_update_upseries(e,t1)}),known_device_types=i.mvars().known_device_types,_.each(s,function(e){var t;e.is_gateway?++o.gateway:++o.repeater,e["usage#"]<o.min_usage&&(o.min_usage=e["usage#"]),e["usage#"]>o.max_usage&&(o.max_usage=e["usage#"]),e["ping_latency#"]>o.max_ping_latency&&(o.max_ping_latency=e["ping_latency#"]),null!=e.mtun_gws_cache?((t=org_overview_data.get_device_status(e))<2?++o.status.online:++o.status.offline,1==t?++o.status.alerting:++o.status["not alerting"]):(e["status#"]<2?++o.status.online:++o.status.offline,e.alerting?++o.status.alerting:++o.status["not alerting"]),x=wrap_space_quotes(known_device_types[node_product_info(e,"type","")]||e.short_description||"Other"),o.device_type[x]=(o.device_type[x]||0)+1}),o.tags=_.chain(s).map(function(e){return $j.trim(e.tags).toLowerCase().split(/\s+/)}).flatten().compact().countBy().value(),o.airmarshal=o.tags.airmarshal||0,o.channel=_.chain(s).pluck("channel").flatten().filter(function(e){return 0!==e&&"all"!==e}).countBy().value(),void 0!==l&&(n=l.checkboxHTML,r="",t=$j("<div />"),s=$j("<div />"),Mkiconf.has_wireless&&(a=$j("<div />").append(t).append(s),o.gateway&&t.append($j(n("is:gateway","Gateway"))),o.repeater&&t.append($j(n("is:repeater","Repeater"))),o.airmarshal&&(s.append($j(n("tag:airmarshal","AirMarshal"))),s.append($j(n("-tag:airmarshal","non-AirMarshal")))),a.length&&(r+="<div class='field'>"+a.html()+"</div>")),$j("#search_holder .checkboxes").html(r),build_advanced_search_select("#tag_search",o.tags),build_advanced_search_select("#channel_search",o.channel),build_advanced_search_select("#status_search",o.status),build_advanced_search_select("#device_type_search",o.device_type,function(e){return strip_quotes(e)}))}}!function(r){var e;l3_nodes.make_concentrator_table=function(){return make_flex_table({loading:!0,container:"#concentrator_endpoints",className:"compact fill",columns:{ng:{l:"Network",render:"[%= link_to_node_group(item.ng, item.ng_name) %]"},ssid:{l:"SSID",render:"[%= item.ssid_name %]"},nodes:{l:"Access points",render:"[%= item.nodes.length %]"},status:{l:"Status",render:"[%= show3.vpn_status_html(item) %]"}},selected_fields:["ng","ssid","nodes","status"]})},l3_nodes.utilization_warning=function(e){return 70<e?"(Very high, likely a problem)":60<e?"(High, likely a problem)":35<e?"(Moderate)":"(Acceptable)"},l3_nodes._graph_current_usage_plugin_skel=function(e,t,a,n){var r,s=Mkijson.main.meta,o=s.grapht1||s.t1||Mkijson.n.allmeta.t1,i=e.data[e.data.length-1][0],_=i/1e3-300,s=i/1e3-30;for(o<_?o=_:s<o&&(o=s),n.xaxis.min=1e3*o,n.xaxis.max=i,r=e.data.length-1;0<=r;r--)if(e.data[r][0]<1e3*o-15e3){e.data=e.data.slice(r+1);break}a.push(e)},l3_nodes._graph_current_up_plugin=function(e,t,a){var n={data:l3_nodes.current_up_history,lines:{fill:!0,fillColor:mkigraph.fill_color},color:mkigraph.line_color};l3_nodes._graph_current_usage_plugin_skel(n,e,t,a)},l3_nodes._graph_current_down_plugin=function(e,t,a){var n={data:l3_nodes.current_down_history,lines:{lineWidth:1},color:mkigraph.green_line_color};l3_nodes._graph_current_usage_plugin_skel(n,e,t,a)},l3_nodes.current_usage_resizer=function(){var e=jQuery("#current_usage_canvas"),t=e.parent().width();t!=e.width()&&(e.empty().width(t),l3_nodes.graph_current_usage())},l3_nodes.graph_current_usage=function(){mkigraph.timeseries("current_usage",{canvas:"#current_usage_canvas",dont_retry:!0,yaxis:{min:0,ticks:mkigraph.tick_generators.bpsTickGenerator}})},l3_nodes.current_up_history=[],l3_nodes.current_down_history=[],l3_nodes.data_transfer_history=((e=[]).empty_out=function(){for(;this[0];)this.pop()},e.last=function(e){return this[this.length-(e=e||1)]},e.calc_current_usage=function(){if(this.length<2)return 0;var e=this.last(),t=this.last(2),a=e.rx_bytes<t.rx_bytes?8*(Math.pow(2,32)-t.rx_bytes+e.rx_bytes):8*(e.rx_bytes-t.rx_bytes),n=e.tx_bytes<t.tx_bytes?8*(Math.pow(2,32)-t.tx_bytes+e.tx_bytes):8*(e.tx_bytes-t.tx_bytes),t=e.time-t.time,a=Math.floor(a/t),t=Math.floor(n/t);return l3_nodes.current_up_history.push([1e3*e.time,t+a]),l3_nodes.current_down_history.push([1e3*e.time,a]),[a,t]},e),l3_nodes.render_if_stats_init=function(e){Mkijson.main.meta.grapht1=e,l3_nodes.data_transfer_history.empty_out(),l3_nodes.current_up_history=[[1e3*e,0]],l3_nodes.current_down_history=[[1e3*e,0]],mkigraph.add_plugin("current_usage",l3_nodes._graph_current_up_plugin),mkigraph.add_plugin("current_usage",l3_nodes._graph_current_down_plugin),jQuery(window).resize(l3_nodes.current_usage_resizer),jQuery(l3_nodes.current_usage_resizer),l3_nodes.graph_current_usage()},l3_nodes.render_if_stats=function(e){var t=l3_nodes.data_transfer_history;0<t.length&&e.time-t[t.length-1].time<5||(t.push(e),(t=t.calc_current_usage())&&(r('[name="status_current_up"]').text(unparse_size(t[1],!0,"bps")),r('[name="status_current_down"]').text(unparse_size(t[0],!0,"bps")),r('[name="status_current_usage"]').text(unparse_size(t[0]+t[1],!0,"bps")),r("#status_current_usage_line_loading").hide(),r("#status_current_usage_line").show()))},l3_nodes.render_channel_info=function(e){r("#status_channel_utilization_loading").hide(),r("#bar0_text").html("Channel "+e[0].channel+": "+Math.round(e[0].total)+"% utilization "+l3_nodes.utilization_warning(e[0].total)),r("#bar0").show(),r("#bar0_tx").width(e[0]._80211+"%"),r("#bar0_non80211").width(e[0].non_80211+"%"),r("#bar1").toggle(1<e.length),1<e.length&&(r("#bar1_text").html("Channel "+e[1].channel+": "+Math.round(e[1].total)+"% utilization "+l3_nodes.utilization_warning(e[1].total)),r("#bar1_tx").width(e[1]._80211+"%"),r("#bar1_non80211").width(e[1].non_80211+"%")),r("#status_channel_utilization").show()};var s=r("#clone_node_d .alert"),a=r("#clone_node_d .btn"),o=!0;function t(e){var a=[],n={};Mkijson.n.clones=e,_.each(e,function(e,t){var a=e.name||e.mac;e.network_eid!==Mkiconf.network_eid&&e.network_name&&(a=e.network_name+": "+a),n[e.network_eid]=n[e.network_eid]||[],n[e.network_eid].push("<option value='"+t+"' data-model='"+e.model+"'>"+a+"</option>")}),_.each(n,function(e,t){_.each(e,function(e){t===Mkiconf.network_eid?a.unshift(e):a.push(e)})}),r("#clone_node select").html(a.join("")).addClass("chosen-select").chosen(),r("#clone_node_d").on("click",".chosen-results",function(e){e.stopPropagation()}),r("#clone_node").on("click.dropdown",l),window.clone_node_select_populated=!0}l3_nodes.populate_clone_select=function(e){r.ajax({type:"GET",dataType:"json",url:Mkiconf.node_json_url,data:r.extend(e,{orgwide:!0,switches_only:!0,f:"name mac model network_id network_name"}),success:function(e){t(e.nodes)},error:function(e){t(Mkijson&&Mkijson.n&&Mkijson.n.hash)}})},l3_nodes.clone_nodes_selected=function(e){var t;o&&((t=Mkijson.n.clones[e]).name||t.mac,a.removeClass("btn-primary").button("updating"),flex_table.submit_checked_items(url_for({action:"clone"}),{clone_src:e}).fail(c).done(n))};var i=[["GS110-8-HW","GS110-8P-HW"],["MS120-8-HW","MS120-8LP-HW","MS120-8FP-HW"],["MS220-8-HW","MS220-8P-HW"],["GS110-24-HW","GS110-24P-HW"],["MS120-24-HW","MS120-24P-HW"],["MS125-24-HW","MS125-24P-HW"],["MS22-HW","MS22P-HW","MS220-24-HW","MS220-24P-HW"],["MS210-24-HW","MS210-24P-HW"],["GS110-48-HW","GS110-48P-HW"],["MS120-48-HW","MS120-48LP-HW","MS120-48FP-HW"],["MS125-48-HW","MS125-48LP-HW","MS125-48FP-HW"],["MS210-48-HW","MS210-48LP-HW","MS210-48FP-HW"],["MS220-48-HW","MS220-48LP-HW","MS220-48FP-HW"],["MS225-24-HW","MS225-24P-HW"],["MS225-48-HW","MS225-48LP-HW","MS225-48FP-HW"],["MS250-24-HW","MS250-24P-HW"],["MS250-48-HW","MS250-48LP-HW","MS250-48FP-HW"],["MS320-24-HW","MS320-24P-HW"],["MS42-HW","MS42P-HW","MS320-48-HW","MS320-48LP-HW","MS320-48FP-HW"],["MS350-24-HW","MS350-24P-HW"],["MS350-24X-HW"],["MS350-48-HW","MS350-48LP-HW","MS350-48FP-HW"],["MS410-16-HW"],["MS410-32-HW"],["MS420-24-HW"],["MS420-48-HW"],["MS425-16-HW"],["MS425-32-HW"]];function l(){var a=null,e=!1,t=$j(this).find("select"),n=t.find("option");d(),_.each(flex_table.checked_items(),function(t){null==a?a=_.find(i,function(e){return _.contains(e,t.model)}):_.contains(a,t.model)||(e=!0)}),t.attr("disabled",e),o=!0,e&&(s.text("The target switches must all have the same port configuration").removeClass("hide"),o=!1),n.each(function(e,t){_.contains(a,$j(t).data("model"))?$j(t).attr("disabled",!1):$j(t).attr("disabled","disabled")}),_.each(flex_table.checked_items(),function(e){n.filter("[value='"+e.id+"']").attr("disabled","disabled")}),t.trigger("chosen:updated")}function d(){a.addClass("btn-primary").removeClass("btn-success").removeClass("btn-danger").button("reset"),s.addClass("hide").removeClass("alert-success").removeClass("alert-danger")}function n(e){a.addClass("btn-success").button("updated"),s.html("Successfully copied settings").removeClass("hide").addClass("alert-success").alert(),setTimeout(d,3e3)}function c(e){var t="Failed to copy settings";try{t=JSON.parse(e.responseText).error}catch(e){}a.addClass("btn-danger").button("error"),s.html(t).removeClass("hide").addClass("alert-danger").alert(),setTimeout(d,1e4)}}(jQuery);var vdt_object,outage_graph_hiatus=new Hiatus({max_run_size:10,timeout_length:1});function node_list3_load(){$j.extend(node_list3_load.table_options,{footer:!0,search_filter:search_filter,row_id_prefix:!0}),Mkijson.n.flex_table=flex_table=make_flex_table(node_list3_load.table_options),flex_table.container.on("table_rendered change:outage_graph",function(){_.contains(flex_table.selected_fields(),"outage_graph")&&outage_graph_hiatus.run_with_array(flex_table.items(!0),function(e){_.each(e,function(e){$j("#outage_graph_canvas_"+e.id).outage_graph(e)})})}).one("table_rendered",data3_column_loader("n",{"watchdog#":!0,channel:!0,nass:!0,node_uptime:!0,num_active_ports:!0,lldp_info0:!0,lldp_info1:!0},flex_table)),data3_bind_change(flex_table,{id:!0,notes:!0,tags:!0,upseries:!0,nuseblocks:!0}),initialize_action_bar()}function _remove_nodes_selected(){var e=flex_table.checked_items();$.top_status({content:"Removing "+Mkiconf.devices_noun_plural+"...",box_class:"alert"}),$j.post(url_for({controller:"node_group",action:"remove_nodes"}),{nodes:_(e).pluck("serial")}).done(function(){$j.top_status({content:"Successfully removed the selected "+Mkiconf.devices_noun_plural,box_class:"alert-success",remove_after:3e3}),flex_table.set_items(_.difference(flex_table.items(),e))}).fail(function(e){var t;try{t=JSON.parse(e.responseText).error}catch(e){t="Could not remove the selected "+Mkiconf.devices_noun_plural}$j.top_status({content:t,box_class:"alert-danger",remove_after:3e3})}).always(function(){$j("#action_move").removeClass("open")})}function initialize_action_bar(){initialize_tag_actions({selector:"#action_tag",url:url_for({action:"update_tags"}),table_div:"#nodes_div",data:Mkijson.n.hash,get_checked:function(){return flex_table.checked_items()},update_checked:function(e,a){_.each(flex_table.checked_items(),function(t){t.tags=t.tags||"",_(e||[]).each(function(e){t.tags+=" "+e+" "}),_(a||[]).each(function(e){t.tags=t.tags.replace(" "+e+" "," ")})}),flex_table.rerender_columns(["tags"])}}),$j("#clone_node button").click(function(){l3_nodes.clone_nodes_selected($j("#clone_node select").val())}),$j("#move_nodes button").click(function(){var e=$j(this);e.prop("disabled",!0);var t,a=$j("#action_move select.move_network_selector").val();a!==Mkiconf.network_eid&&show3.confirm_change_network(flex_table.checked_items().length)&&(t=flex_table.checked_items(),$j.post(url_for({controller:"nodes",action:"move_devices"}),{ids:_(t).ids(),network:a}).done(function(){$j.top_status({content:"Successfully moved the selected "+Mkiconf.devices_noun_plural,box_class:"alert-success",remove_after:3e3}),flex_table.set_items(_.difference(flex_table.items(),t))}).fail(function(e){var t;try{t=JSON.parse(e.responseText).error}catch(e){t="Could not move the selected "+Mkiconf.devices_noun_plural}$j.top_status({content:t,box_class:"alert-danger",remove_after:3e3})}).always(function(){$j("#action_move").removeClass("open"),e.prop("disabled",!1)}))}),$j("#remove_nodes button").click(_remove_nodes_selected)}function vlan_debugging_tool(e,t,a){var n=0;this.vap_state_table_id=e,this.vlan_state_table_id=t;var r=a;vdt_object=this;var t='class="fancy_table" style="margin-top:5px;text-align:center;"',a=["<br/>Last {{= it.length}} DHCP requests<br/>","<table "+t+">","<thead>","<tr>","<th>Req. ID</th>","<th>SSID</th>","<th>Client MAC</th>","<th>Server IP</th>","<th>Req. type</th>","<th>Req. IP</th>","<th>Resp. type</th>","<th>Resp. IP</th>","<th>RTT(ms)</th>","<th>Ago(s)</th>","</tr>","</thead>","<tbody>","{{~ it :row}}","<tr>","<td>{{= row.id}}</td>","<td>{{! (Mkiconf.ssids[row.vap]||{name: '—'}).name}}</td>","<td>{{! row.client_mac}}</td>","<td>{{! row.server_ip}}</td>","<td>{{! row.req_type}}</td>","<td>{{! row.req_ip}}</td>","<td>{{! row.res_type}}</td>","<td>{{! row.res_ip}}</td>","<td>{{= row.rtt}}</td>","<td>{{= row.ago}}</td>","</tr>","{{~}}","</tbody>","</table>"].join(""),s=doT.template(a),a=["<br/>Last {{= it.length}} DNS requests<br/>","<table "+t+">","<thead>","<tr>","<th>Req. ID</th>","<th>SSID</th>","<th>Client IP</th>","<th>Server IP</th>","<th>Opcode</th>","<th>Rcode</th>","<th>RTT(ms)</th>","<th>Ago(s)</th>","</tr>","</thead>","<tbody>","{{~ it :row}}","<tr>","<td>{{= row.id}}</td>","<td>{{! (Mkiconf.ssids[row.vap]||{name: '—'}).name}}</td>","<td>{{! row.client_ip}}</td>","<td>{{! row.server_ip}}</td>","<td>{{! row.opcode}}</td>","<td>{{! row.rcode}}</td>","<td>{{= row.rtt}}</td>","<td>{{= row.ago}}</td>","</tr>","{{~}}","</tbody>","</table>"].join(""),o=doT.template(a),a=["<br/>Last {{= it.length}} ARP requests<br/>","<table "+t+">","<thead>","<tr>","<th>SSID</th>","<th>Source IP</th>","<th>Source MAC</th>","<th>Dest. IP</th>","<th>Dest. MAC</th>","<th>RTT(ms)</th>","<th>Ago(s)</th>","</tr>","</thead>","<tbody>","{{~ it :row}}","<tr>","<td>{{! (Mkiconf.ssids[row.vap]||{name: '—'}).name}}</td>","<td>{{! row.source_ip}}</td>","<td>{{! row.source_mac}}</td>","<td>{{! row.dest_ip}}</td>","<td>{{! row.dest_mac}}</td>","<td>{{= row.rtt}}</td>","<td>{{= row.ago}}</td>","</tr>","{{~}}","</tbody>","</table>"].join(""),i=doT.template(a),t=["<br/>Last {{= it.length}} RADIUS requests<br/>","<table "+t+">","<thead>","<tr>","<th>Req. ID</th>","<th>Client MAC</th>","<th>Server IP</th>","<th>Req. type</th>","<th>Resp. type</th>","<th>RTT(ms)</th>","<th>Ago(s)</th>","</tr>","</thead>","<tbody>","{{~ it :row}}","<tr>","<td>{{= row.id}}</td>","<td>{{! row.client_mac}}</td>","<td>{{! row.server_ip}}</td>","<td>{{! row.req_code}}</td>","<td>{{! row.res_code}}</td>","<td>{{= row.rtt}}</td>","<td>{{= row.ago}}</td>","</tr>","{{~}}","</tbody>","</table>"].join(""),_=doT.template(t);function l(e,t,a,n){e+=" status: ";return e+=0<a?a==n?"All "+a+" recent requests received responses.<br/>":a-n+" out of "+a+" recent requests did not receive responses.<br/>":"No recent requests.<br/>"}function d(e){var t="<br/>";return t+=l("RADIUS",e.radius_detected,e.summary_stats.radius_request.length,e.radius_response_count)}function c(e){var t="<br/>";return t+=l("ARP",e.arp_detected,e.summary_stats.arp_request.length,e.arp_response_count),t+=l("DNS",e.dns_detected,e.summary_stats.dns_request.length,e.dns_response_count),t+=l("DHCP",e.dhcp_detected,e.summary_stats.dhcp_request.length,e.dhcp_response_count),null!=e.last_tx_ago&&(t=t+"Last TX ago: "+e.last_tx_ago+"<br/>"),null!=e.last_rx_ago&&(t=t+"Last RX ago: "+e.last_rx_ago+"<br/>"),null!=e.tx_packet_count&&(t=t+"TX packet count: "+e.tx_packet_count+"<br/>"),null!=e.rx_packet_count&&(t=t+"RX packet count: "+e.rx_packet_count+"<br/>"),t=null!=e.broadcast_rate?t+"Broadcast Rate: "+e.broadcast_rate+"<br/>":t}function u(e,t,a){var n=$j("<span>"),a=(a?d:c)(t);return t.problem?$j('<span id="status_problem" style="font-weight:bold; background-color: #FF4000;">').appendTo(n).append("Problem"):$j('<span id="status_ok" style="font-weight:bold;">').appendTo(n).append("OK"),n.append("&nbsp;"),$j("<span>",{class:"toggle-parent",id:e}).appendTo(n).append($j("<a>",{href:"#",class:"link toggle"}).html("Show&nbsp;&raquo;")),$j("<span>",{class:"hide toggle-parent"}).appendTo(n).append($j("<a>",{href:"#",class:"link toggle"}).html("&laquo;&nbsp;Hide")).append("&nbsp;&nbsp;").append($j("<img>",{src:"/images/spinner.gif",alt:"Loading",id:"spinner"})).append($j("<div>",{id:"summary_table"+e}).html(a)).append($j("<div>",{id:"details_table"+e}).html("")),n[0].innerHTML}function h(e,t,a){var n,r,s,o,i,_=0;for(n in t)a&&(!Mkiconf.ssids[n].enabled||"8021x-custom"!=Mkiconf.ssids[n].association_control_method&&"open_with_radius"!=Mkiconf.ssids[n].association_control_method)||(o=_%2==0?"ft0":"ft1",r=$j(e+" > tbody > tr:nth-child("+(_+2)+")"),s=n,a?s=Mkiconf.ssids[n].name:0==n&&(s="Untagged"),void 0===r.attr("id")?$j(e).append($j('<tr class="base '+o+'" id="'+n+'">').append($j('<td class="ft">').text(s)).append($j('<td class="ft">').html(u(n,t[n],a)))):(i=r.children("td").eq(1).children("span").eq(0).attr("id"),o=t[n].problem?"status_problem":"status_ok",r.attr("id")!=n?(r.attr("id",n),r.children("td").eq(0).text(s),r.children("td").eq(1).html(u(n,t[n],a))):o!=i?r.children("td").eq(1).html(u(n,t[n],a)):(i=(a?d:c)(t[n]),r.children("td").eq(1).children("span").eq(2).children("div").eq(0).html(i))),++_);return $j(e).children("tbody").eq(0).children("tr:gt("+_+")").remove(),0<_}function p(e){if(null!=e.data.vap){for(var t in e.data.vap)$j(vdt_object.vap_state_table_id).find("#details_table"+t).html(vdt_object.generate_status_details_table(e.data.vap[t].detailed_stats));$j(vdt_object.vap_state_table_id).find("#spinner").hide()}if(null!=e.data.vlan){for(var t in e.data.vlan)$j(vdt_object.vlan_state_table_id).find("#details_table"+t).html(vdt_object.generate_status_details_table(e.data.vlan[t].detailed_stats));$j(vdt_object.vlan_state_table_id).find("#spinner").hide()}}this.generate_vap_table_rows=function(e){return h(this.vap_state_table_id,e,!0)},this.generate_vlan_table_rows=function(e){return h(this.vlan_state_table_id,e,!1)},this.start_detailed_req=function(){0==n&&(this.detailed_req=$j.comet.command_subscribe({broker:"VlanDebugState",vap_detailed:!0,vlan_detailed:!0},r,p)),n+=1},this.stop_detailed_req=function(){--n<=0&&(this.detailed_req.stop(),$.comet.unsubscribe_pattern("VlanDebugState"))},this.generate_status_details_table=function(e){if(void 0===e)return"";var t,a="";for(t in e)0!=e[t].length&&("dhcp_request"==t?a+=s(e[t]):"dns_request"==t?a+=o(e[t]):"arp_request"==t?a+=i(e[t]):"radius_request"==t&&(a+=_(e[t])));return a}}node_list3_load.make_link_render=function(r){return function(e){for(var t,a={name:1,mac:1,serial:1},n=0;n<e.length&&!a[e[n]];++n);return t="name"==r?"escape(item."+r+" || item.mac)":"item."+r,e[n]!=r||Mkiconf.monitor_only?"[%= "+t+" %]":"[%= node3_render_name(item, "+t+") %]"}},node_list3_load.table_options={container:"#nodes_div",className:"nodes_filter",addons:["checkbox","add_col","drag_col","hotkeys"],row_num:!1,row_click:function(e,t){return urlHash.pushState({n:e.id},!0)},lazy_load:["watchdog#","channel","nass","node_uptime","num_active_ports","lldp_info0","lldp_info1"]};