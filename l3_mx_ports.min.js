/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
window.l3_mx_ports=function(a){var t,s,n,r={},o=!1;return r.update_ports=function(l,e,s){o&&(l&&_.each(s,function(e){newAllowedVlans=_.filter(l.allowed_vlans,function(e){return"Multiple values"!==e}),e.allowed_vlans=_.contains(l.allowed_vlans,"Multiple values")?_.union(newAllowedVlans,e.allowed_vlans):newAllowedVlans,_.contains(e.allowed_vlans,"all")&&(e.allowed_vlans=["all"]),_.extend(e,_.omit(l,"allowed_vlans")),"true"==e.enabled&&"false"!=e.is_trunk||(delete e.native_vlan_guid,delete e.allowed_vlans),"true"==e.enabled&&"true"!=e.is_trunk||(delete e.access_vlan_guid,"access_policy_type"in e&&delete e.access_policy_type),"true"!=e.enabled&&delete e.is_trunk}),e&&(n=e),s=_.omit(t,"checked"),e=JSON.stringify(s),a("#mx_ports_serialized").val(e),change_tracker.change("mx_ports_serialized",e),s=n,e=JSON.stringify(s),a("#mx_ports_radius_servers_serialized").val(e),change_tracker.change("mx_ports_radius_servers_serialized",e),flex_table.set_items(t),a("#per_port_vlan_ecos_current").hide())},r.cleanup_for_deleted_vlans=function(){_.each(t,function(e,l){"true"===e.enabled&&("true"===e.is_trunk?(_.has(Mkijson.mx_configured_vlans,e.native_vlan_guid)||(e.native_vlan_guid="0"),e.allowed_vlans=_.filter(e.allowed_vlans,function(e){return"all"==e||Mkijson.mx_configured_vlans[e]}),0==e.allowed_vlans.length&&(e.enabled="false",e.allowed_vlans=["all"])):Mkijson.mx_configured_vlans[e.access_vlan_guid]||(e.enabled="false",e.access_vlan_guid="0","access_policy_type"in e&&(e.access_policy_type="open")))}),r.update_ports()},r.make_mx_ports_table=function(){if(!Mkijson.has_mx_node)return a("#no_mx_node").show(),void a("#mx_ports_table").hide();t=Mkijson.mx_ports,(s=Mkijson.mx_ports_has_auths)&&(n=Mkijson.mx_ports_radius_servers);var e=[];Mkiconf.has_mx_modules&&e.push("module");var _=["port","enabled","type","access_vlan_guid","allowed_vlans"];s&&_.push("access_policy_type");e=e.concat(_),_={module:{l:"Module",render:"[%= render_mx_module_name(item) %]"},port:{l:"Port",render:"[%= 'LAN '+(item.port_idx) %]",sort_by:"port_idx"},enabled:{l:"Enabled?",render:"[%= item.enabled == 'true' ? 'enabled' : 'disabled' %]"},type:{l:"Type",dashhelp:"mx_port_type",sort_by:"is_trunk",render:"[%= item.enabled === 'false' ? '&mdash;' :(item.is_trunk === 'true' ? 'trunk' : 'access') %]"},access_vlan_guid:{l:"VLAN",dashhelp:"mx_port_vid",render:"[%= render_mx_port_vlan(item) %]"},allowed_vlans:{l:"Allowed VLANs",render:"[%= render_mx_port_allowed_vlans(item) %]",group:"Configuration",dashhelp:"mx_port_allowed_vlans",sort_by:!1}};s&&(_.access_policy_type={l:"Access policy",render:"[%= render_mx_port_access_policy_type(item) %]",dashhelp:"mx_port_access_policy_type",sort_by:!1}),"undefined"==typeof flex_table?(flex_table=make_flex_table({row_id_prefix:!0,items:Mkijson.mx_ports_list,columns:_,addons:["checkbox"],container:"#mx_ports_div",className:"compact fill",row_class_template:"ftp[%= index % 2 %]",row_click:function(e){mx_ports_edit_dialog.show([e],n,r.update_ports)},selected_fields:e,add_col:!1,sort_field:Mkiconf.has_mx_modules?"-module":null,row_num:!1}),l="#mx_ports_edit_button",a(document).on("click",l,function(e){return e.preventDefault(),a(this).is(".disabled")||mx_ports_edit_dialog.show(flex_table.checked_items(),n,r.update_ports),!1})):flex_table.set_items(Mkijson.mx_ports_list);var l=JSON.stringify(t);a("#mx_ports_serialized").val(l),change_tracker.track("mx_ports_serialized",l),l=JSON.stringify(n),a("#mx_ports_radius_servers_serialized").val(l),change_tracker.track("mx_ports_radius_servers_serialized",l),o=!0},r.get_mx_ports=function(){return t},r}(jQuery);