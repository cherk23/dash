/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
var mki_last_ifstats={},mki_live_tests=function(h){var c,r,d,l=!1,o=0,_={},u={ping:{name:"ping",render:function(t){var e,n="";0<(t.sent||0)&&(n+="Sent "+t.sent+" ping packet"+(1<t.sent?"s":"")+" from meraki.com.<br />",n+="Round-trip loss rate "+((t.sent-t.rcvd)/t.sent*100).toFixed(1).replace(/\.0$/,"")+"%",t.rcvd&&(n+=", average latency "+t.rtt.toFixed(2)+" ms"),n+=".",20<t.sent&&(n+="<br />Last 20 pings: round-trip loss rate "+((20-t.rcvd_20)/20*100).toFixed(1).replace(/\.0$/,"")+"%",t.rcvd_20&&(n+=", average latency "+t.rtt_20.toFixed(2)+" ms"),n+="."),e=h("#testc_ping_canvas"),h.plot(e.show(),[{data:t.data,color:"rgba(126,161,180,1)",lines:{show:!0,lineWidth:1,fill:!0,fillColor:"rgba(222,231,236,1)",shadowSize:0}}],{yaxis:{min:0,ticks:mkigraph.tick_generators.msTickGenerator3}}));h("#testc_ping").html(n)},delay:1.5,l:"Ping this access point",data_url:"live_ping_data/%N"},blink_leds:{name:"blink_leds",render:function(t,e){h("#testc_"+this.name+"_result").show(),null!=t.status&&!t.error||h("#testc_"+this.name+"_result").hide()},delay:5,l:"Blink the LEDs on this access point",data_url:"blink_leds_data/%N"},dashboard_reboot:{name:"dashboard_reboot",render:function(t,e){h("#testc_"+this.name+"_result").show(),null!=t.status&&!t.error||h("#testc_"+this.name+"_result").hide()},delay:4,l:"Reboot this access point.",data_url:"dashboard_reboot_data/%N",confirm:"Are you sure?\nRebooting an access point will temporarily disconnect all clients."},clientarping:{name:"clientarping",render:w,show_client_mac:!0,delay:1.5,l:"Ping client MAC",data_url:"clientarping_data/%N?client=%C",after_prompt:function(t){return this.values={C:t.find(".lt_client_mac").val()},!0}},clientfindarping:{name:"clientfindarping",render:w,delay:1.5,l:"Ping client",data_url:"clientfindarping_data?client=%C&mac=%M"}};function p(t){return"&nbsp;<span class='barsep'>|</span>&nbsp;<a href='javascript:mki_live_tests.close(\""+t+"\")'><img src='"+Mkiconf.images+"onebyone.gif' class='ltclose' alt='Close' title='Close test' /></a>"}function m(t,e){var n,a,s=u[t],i=h("#testc_"+t);l&&s&&(s.hide_random_status_box&&i.hide(),!e&&0<(n=i.parent().find(".ltprompt")).length?(h("#teststat_"+s.name).html(p(t)),n.show(),n.find(".lt_run").unbind("click.lt_run").bind("click.lt_run",(a=s,function(){var t=h("#testc_"+a.name).parent();a.after_prompt&&!a.after_prompt.call(a,t)||(t.find(".ltprompt").hide(),m(a.name,!0))})),i.html(""),i.parent().find(".ltsupplement").hide(),k(t,"s")):s.confirm&&!confirm(s.confirm)||(s.result={_starting:1,status:1},v(s,"s"),f.call(s)))}function f(){var t,e,a,s,n=this,i=n.data_url,l=n.result&&n.result.reqid||0;for(t in _)i=i.replace("%"+t,encodeURIComponent(_[t]));for(t in e=n.values||{})i=i.replace("%"+t,encodeURIComponent(e[t]));h.ajax({url:url_for({action:i}),success:(a=n.name,s=o,function(t){var e=u[a],n=e&&e.result&&e.result.reqid||0;if(e&&s==o&&e.result&&0<e.result.status&&(!t.id||!_.N||t.id==_.N)&&(n<=0||n==t.reqid)){if(e.timeout&&clearTimeout(e.timeout),e.timeout=null,(t.status||0)<0&&t.retry)return e.retry_timeout=Math.min(2*(e.retry_timeout||.5),64),void(e.timeout=setTimeout(g(e.name,n),1e3*e.retry_timeout));(e.result=t).at&&(t.__at_offset=(new Date).getTime()/1e3-t.at),v(e,"j"),0<t.status&&t.reqid&&e.delay&&(e.timeout=setTimeout(g(e.name,t.reqid),1e3*e.delay))}}),data:0<l?{reqid:l}:{},type:"POST"})}function g(e,n){return function(){var t=u[e];t&&(t.timeout=null,t.result&&((t.result.reqid||0)<=0||t.result.reqid==n)&&f.call(t))}}function v(t,e){var n=t.name,a=h("#testc_"+n),s=t.result,i=h("#teststat_"+n),l="&nbsp;<span class='barsep'>|</span>&nbsp;",r=h("#testhb_"+n);r.length&&(!s||!s.status||s.status<0?r.html("<img src='"+Mkiconf.images+"onebyone.gif' class='ltplay' alt='Go' title='Run test' /> "):r.html("<img src='"+Mkiconf.images+"onebyone.gif' class='ltstop' alt='Stop' title='Stop' /> ")),s&&!s._starting?t.render(s,_):a.html(""),k(n,e),l=s?null==s.status?l+"Stopped":s.status<0?l+"Failed":0==s.status?l+"Done":t.quiet_status?l+"Running...":l+baseline_spinner_html()+" Running...":"",!t.uncloseable&&s&&(l+=p(n)),i.html(l)}function w(t){var e,n,a,s,i,l,r,o=this,c="",d=[],_=(new Date).getTime()/1e3-(t.__at_offset||0),u=null;for(u in t.clients||{});if(e=(u?t.clients[u]:null)||{},u=[],window.s3node&&window.s3node.iswd||(Mkiconf.has_wired||null==e.ssid||u.push("on "+mki_render_ssid(e.ssid)),(e.node_id&&(i=nodes_hash[e.node_id])||e["last_seen_by#"]&&(i=nodes_hash[e["last_seen_by#"]]))&&u.push("at "+node3_render_name(i)),e.ass_at?u.push("for "+unparse_interval(_-e.ass_at)):e.ass_at_weak?u.push("for &gt; "+unparse_interval(_-e.ass_at_weak)):e.ass_ago?u.push("for "+unparse_interval(e.ass_ago)):e.ass_ago_weak&&u.push("for &gt; "+unparse_interval(e.ass_ago_weak)),u.length&&o.show_client_mac&&d.push("Client MAC: "+JSTemplate.escape(e.mac||o.values.C)),u.length&&(Mkiconf.has_wired?d.push("Connected "+u.join(" ")+"."):d.push("Associated "+u.join(" ")+"."))),u=[],e.is_wired?u.push("Connection: wired"):e.channel?u.push("Channel: "+e.channel):e.inum&&(i=e.node_id?nodes_hash[e.node_id]:e["last_seen_by#"]?nodes_hash[e["last_seen_by#"]]:window.s3node)&&(s=node_product_info(i,"interface_names")[e.inum-1])&&u.push("Via radio "+JSTemplate.escape(s)),(s=e.rssi_samples)&&Array.isArray(s)){for(l=1e4,r=0,a=s.length-1;0<=a;--a)l=Math.min(l,s[a]),r=Math.max(r,s[a]);s=s[s.length-1]}else e.rssi?l=r=s=e.rssi:s=0;s&&l==s&&r==s?u.push("Signal: "+s+" dB"):s&&u.push("Signal: "+s+" dB (range "+l+"&ndash;"+r+" dB)"),e.ass_identity&&u.push("Identity: "+JSTemplate.escape(e.ass_identity)),u.length&&d.push(u.join(" <span class='barsep'>|</span> ")),!1===e.auth&&d.push("<span class='redbold'>Client not authenticated.</span>"),d.length&&(c+="<div style='padding:0 0 5px'>"+d.join("<br />")+"</div>"),(t.status||0)<0&&t.error?c+=t.error:0<=(t.status||0)&&(n=e.arping)&&0<n.sent&&(c+="Sent "+n.sent+" ping packet"+(1<n.sent?"s":"")+" to client.<br />",c+="Round-trip loss rate "+((n.sent-n.rcvd)/n.sent*100).toFixed(1).replace(/\.0$/,"")+"%",n.rcvd&&(c+=", average latency "+n.rtt.toFixed(2)+" ms"),c+=".",20<n.sent&&(c+="<br />Last 20 pings: round-trip loss rate "+((20-n.rcvd_20)/20*100).toFixed(1).replace(/\.0$/,"")+"%",n.rcvd_20&&(c+=", average latency "+n.rtt_20.toFixed(2)+" ms"),c+="."),d=h("#testc_"+o.name+"_canvas"),h.plot(d.show(),[{data:n.data,color:"rgba(126,161,180,1)",lines:{show:!0,lineWidth:1,fill:!0,fillColor:"rgba(222,231,236,1)",shadowSize:0}}],{yaxis:{min:0,ticks:mkigraph.tick_generators.msTickGenerator3}})),h("#testc_"+o.name).html(c),"clientfind"==o.name&&0==t.status&&window.update_map_client_location&&window.update_map_client_location(e,_)}function y(t){return(t=t||h("#s3nlt_tools")).find(">tbody>tr").children()}function b(t){var e,t=t.childNodes[0];return t&&(e=t.id)&&"s3nlt_"==e.substr(0,6)?e.substr(6):""}function t(t,e){var n=u[t];return l&&n&&(0<(e=null==e?n.result&&0<(n.result.status||0)?-1:1:e)?m(t):e<0&&n.result&&(n.result.status=null,n.result.reqid=0,v(n))),!1}function x(t){var e,n=h("#s3nlt_tools"),a=n.width(),s=n.height(),i=y(n),l=h("#s3nlt_container").width();t="number"==typeof t?t:0,n=(c=Math.max(0,Math.min(i.length-2,c+(t||0))))?h(i[c+1]).position().left-20:0,t||r<0?(h("#s3nlt_shifter").stop().animate({left:-n},{complete:(e=n,function(){r=e})}),r=-1):r!=n&&(h("#s3nlt_shifter").stop().css({left:-n}),r=n),0!=c?h("#s3nlt_left").show().height(s):h("#s3nlt_left").hide(),n+l<a&&c+2<i.length?h("#s3nlt_right").show().height(s):h("#s3nlt_right").hide()}function k(t,e){var n,a,s,i,l,r,o=c;if("s"===e||t==d){for(d=t,n=y(),a=1;a<n.length&&b(n[a])!=t;++a);if(a<n.length&&o!=a-1)if((s=h(n[a]).position().left)<(l=o?h(n[o+1]).position().left:0))o=a-1;else for(i=s+h(n[a]).width(),r=h("#s3nlt_container").width();l+r<i&&l+40<s&&o<n.length-2;)l=h(n[++o+1]).position().left}x(o-c)}function n(t){var e=u[t];e&&!e.uncloseable&&(e.delete_on_close?(delete u[t],h("#s3nlt_"+t).parent().remove(),x(0)):(delete e.values,delete e.result,delete e.retry_timeout,delete e.quiet_status,h("#testc_"+t).html(""),h("#s3nlt_"+t).find(".ltsupplement, .ltprompt").hide(),v(e)))}return t.add_test=function(t){if(!t.name||!t.render)throw new Error("add_test("+(t.name||"")+")");t.get_json=f,u[t.name]=t},t.initialize=function(t){var e,n;for(e in l=!0,_=h.extend({},t),++o,c=r=0,d=null,u)h("#testc_"+e).length&&(v(u[n=e]),dashhelp("test_"+n,"#testh_"+n,{above:!0}));h("#s3nlt_left").click(function(){x(-1),d=!1}),h("#s3nlt_right").click(function(){x(1),d=!1}),x(0),jQuery(window).bind("resize.show3",x)},t.cleanup=function(){var t,e={};for(t in l=!1,_={},++o,jQuery(window).unbind("resize.show3"),u)delete u[t].result,u[t].uncloseable||(e[t]=!0);for(t in e)n(t)},t.close=n,t.ltx_clientarping=function(t,e){var n,a,s=y(),i="ltx_clientarping"+t.replace(/[^0-9a-f]/gi,"");if(!h("#testc_"+i).length){for(n=1;n<s.length-1&&"associations"!=b(s[n]);++n);a=new JSTemplate("<td>"+Mkiconf.ltx_clientarping_template+"</td>"),h(s[n]).after(a.render({id:i,mac:t,description:e||t})),h(s[n].childNodes[0]),u[i]={name:i,render:w,delay:1.5,l:"Ping "+(e||t),data_url:"clientarping_data/%N?client="+encodeURIComponent(t),delete_on_close:!0}}(!(a=u[i]).result||(a.result.status||0)<=0)&&m(a.name,!0)},t}(window.jQuery);!function(a){mki_live_tests.add_test({name:"tcp",render:function(t,e){var n=[];(t.status||0)<0?n.push("No connection available or connection is too weak."):(t.gateway_id&&n.push("Gateway is "+node3_render_name(nodes_hash[t.gateway_id]||{id:t.gateway_id,name:t.gateway_name})+"."),t["gwhops#"]&&1<t["gwhops#"]?(t.my_name=nodes_hash[e.N].name||nodes_hash[e.N].mac,n.push("Using "+t["gwhops#"]+"-hop route "+node3_render_to_gw_route(t))):t["gwhops#"]&&n.push("Using a one-hop (direct) route."),t["dl_speed#"]&&n.push("Got "+unparse_size(8*t["dl_speed#"]*1024,!0,"bps",!0)+" from "+(t.gateway_id?"gateway.":"meraki.com."))),a("#testc_tcp").html("<div style='max-width:40em'>"+n.join("<br />")+"</div>")},delay:2,l:"Run a throughput test",data_url:"live_tcp_test_data/%N"})}(window.jQuery),function(s){mki_live_tests.add_test({name:"associations",render:function(t){var e,n="",a=!1;((e=window.s3node)&&e.id==t.id||window.Mkijson&&(e=Mkijson.n)&&(e=e.hash[t.id]))&&(a=!!e.iswd),0==t.status&&(data3_load.canonicalize(t),e=_.size(t.clients),make_flex_table({items:t.clients,render_context:{json:t},container:"#testc_associations_list",className:"compact fill",columns:usage_list3_load.table_options.columns,selected_fields:a?["description","mac",Mkiconf.ltx_clientarping_template?"ltx_clientarping":"xxx"]:["description","mac","ssid",function(t){for(var e in t)if(t[e].channel)return 1}(t.clients)?"channel":"xxx","rssi_bar","ltx_ass_for",Mkiconf.ltx_clientarping_template?"ltx_clientarping":"xxx"],no_items_html:a?"No active client devices.":"No client devices are currently associated.",row_class_template:"[% if (!item.auth) { %]ft lowlight[% } else { %]ft[%= index % 2 %][% } %]"}),0<e&&(n+="<div style='padding: 5px 0;'>There "+pluralize(e,"client",{are:!0})+" currently "+(a?"active":"associated")+":</div>"),s("#testc_associations_list").show()),s("#testc_associations").html(n)},delay:1.5,l:"Currently associated clients",data_url:"associations_data/%N"})}(window.jQuery),function(h){var p,m,f,e,g;var v,w,y,b,x=[];function k(){clearInterval(e),e=null}function n(){var n=[];if(w=w||[],!p||!p.result)return w=null,x=[],void k();if(!p.result.status||p.result.status<0)k();else{y=y||{width:224,height:100},h.each(f[g],function(t,e){n.push([t,e]),w[t]=w[t]||[],w[t][e]=w[t][e]||0,w[t][e]+=1,x[t]=Math.max(x[t]||10,w[t][e])});var t={yaxis:{min:0,max:100,ticks:mkigraph.tick_generators.rssiTickGenerator3,labelWidth:46,tickFormatter:function(t){return.8*t-100+" dBm"}},xaxis:{min:0,max:224,tickFormatter:function(t){return((.3125*t+2402)/1e3).toFixed(3)+" GHz"}}};if(h("#testc_spectral_canvas").parent().find(".ltsupplement").show(),h.plot("#testc_spectral_canvas",[{data:n,color:"rgba(126,161,180,1)",lines:{show:!0,lineWidth:1,fill:!0,fillColor:"rgba(222,231,236,1)",shadowSize:0}}],t),!v){var e=h.plot("#testc_spectral_heatmap",[[[0,0]]],t);v=h("#testc_spectral_heatmap canvas").last();var a=h("<canvas></canvas>").appendTo("#testc_spectral_heatmap");v.add(a).attr({width:e.width(),height:e.height()}).css({position:"absolute",top:e.getPlotOffset().top+"px",left:e.getPlotOffset().left+"px"}),b={x:e.width()/y.width,y:e.height()/y.height},a=a.css("zIndex",5).get(0),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(a),(a=a.getContext("2d")).strokeStyle="rgba(0, 0, 0, 0.3)";for(var s=e.width()/6,i=0;i<3;i++)a.beginPath(),a.arc(s+2*s*i,e.height(),s-10,0,Math.PI,!0),a.stroke();h.each([{x:115,l:"Channel 1"},{x:295,l:"Channel 6"},{x:475,l:"Channel 11"}],function(t,e){h("<div></div>").appendTo("#testc_spectral_heatmap div.tickLabels").css({position:"absolute",top:"80px",left:e.x+"px",textAlign:"center",zIndex:5}).html(e.l)})}var l=v.get(0).getContext("2d");l.fillStyle="white",l.clearRect(0,0,v.width(),v.height());for(var r=0;r<y.width;r++)for(var o=0;o<y.height;o++){var c,d,_,u=!(r>=w.length)&&!(o>=w[r].length)&&w[r][o]?100*w[r][o]/x[r]:0;u<1||(d=c=255,_=1,u<=50?c=Math.floor(u/50*255):d=Math.floor((100-u)/50*255),l.fillStyle="rgba("+c+","+d+",0,"+(_=u<=20?u/20:_)+")",l.fillRect(r*b.x,(y.height-o)*b.y,b.x,b.y))}(g+=1)==f.length&&(m?(f=m,m=null,g=0,p.get_json()):(f=null,k()))}}p={name:"spectral",render:function(t){0<(t.status||0)&&!t.spectral_data&&p.get_json(),t.spectral_data&&(f?m=t.spectral_data:(f=t.spectral_data,p.get_json(),g=0),e=e||setInterval(n,400))},l:"Perform an interference scan",data_url:"spectral_data/%N",hide_random_status_box:!0},mki_live_tests.add_test(p)}(window.jQuery);