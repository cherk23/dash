/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
var wdc,switch_configs,csui,nodegroup_settings={},ssids=[],access_policies=[],ssids_by_number={},current_ssid=null,current_vlan=null,confirm_unsaved_msg="Are you sure you want to navigate away from this page?\n\nYour changes have not been saved.\n\nPress OK to continue, or Cancel to stay on the current page.";function initialize_custom_pie_chart_ui(e){var n=$j.map(e.rules||nodegroup_settings.custom_counter_set_rules||[],function(e){var n=e.signature;return n?(n.net&&n.port?n.value=n.net+":"+n.port:n.value=n.host||n.port||n.net,$j.extend(e,n)):e}),t={custom_host:"e.g. example.com",custom_port:"e.g. 443",custom_net:"e.g. 192.168.0.0/16",custom_net_and_port:"e.g. 192.168.0.0/16:443"};function r(e,n){e.prop("placeholder",t[n])}$h("#custom_counter_set_rules").flex_editor({add_text:"Add a slice",no_entries_message:"No slices specified.",hide_headers_when_empty:!0,sortable:!0,max_rows:e.max_custom_pie_chart_slices,max_rows_message:"Can not create another pie slice. This pie currently has "+e.max_custom_pie_chart_slices+" slices, which is the maximum.",columns:[{classname:"order",headername:"#",type:"ordernum"},{classname:"name",headername:"Name",type:"inputtext",size:15},{classname:"signature_type",headername:"Signature",type:"inputselect",show_class:!0,options:[["HTTP hostname...","custom_host"],["Port...","custom_port"],["IP range...","custom_net"],["IP range & port...","custom_net_and_port"]]},{classname:"value",headername:"",type:"inputtext",size:25},{classname:"identifier",type:"hidden"},{classname:"",headername:"Actions",type:"actions",delete_tooltip:"Delete this slice"}],rows:n,row_create_callback:function(e,n){var t=e.find(".value input"),i=e.find(".signature_type select");r(t,n.signature_type),i.change(function(){r(t,i.val()),t.val("")})}})}function setup_nat_traversal_options(t){run_with_tmpl("#router_port_forwarding_test_widget_tmpl",function(){$j("#port_forwarding_test_button").click(function(){var n,i={};function e(e){e=$h("#router_port_forwarding_test_widget_tmpl").tmpl(e);e.find("#pfs_cancel_button, #pfs_close_link").click(function(){return n.abort(),hohelp("#port_forwarding_test_button",!1,{sticky:!0}),!1}),e.find("#pfs_retry_button").click(function(){$h("#port_forwarding_test_button").triggerHandler("click")}),hohelp("#port_forwarding_test_button",e,{sticky:!0,atright:!0})}i.device_name=nodegroup_settings.name,i.ip=$h("#wired_config_nat_traversal_ip").val(),i.port=$h("#wired_config_nat_traversal_port").val(),i.completed=!1,e(i),n=$j.ajax({type:"GET",dataType:"json",url:t.test_vpn_port_forwarding_url,data:{ip:i.ip,port:i.port},success:function(e,n){i.passed=e.passed},error:function(e,n,t){i.passed=!1},complete:function(){i.completed=!0,e(i)}})})}),dashhelp("nat_traversal_cfgq","#c_nat_traversal .cfgq"),$j("#c_nat_traversal input[type='radio']").change(function(){$j(this).is(":checked")&&$j("#c_nat_traversal_public_ip_port").toggle("ip_port"==$j(this).val())}),("ip_port"==t.config.wdc.nat_traversal_type?$j("#c_nat_traversal input[type='radio'][value='ip_port']"):$j("#c_nat_traversal input[type='radio'][value='automatic']")).prop("checked",!0).triggerHandler("change"),$j("#wired_config_nat_traversal_ip").val(t.config.wdc.nat_traversal_ip),$j("#wired_config_nat_traversal_port").val(t.config.wdc.nat_traversal_port)}!function(i){i.fn.mki_form_as_json=function(){var n={},t=[],e=i(this);return jQuery(":input:not(.nosave, .nosave :input, [name=''])",e).each(function(){var e=jQuery(this);"radio"==e.attr("type")&&n[e.attr("name")]||e.attr("name")&&(n[e.attr("name")]=e.mval()),jQuery(this).is(":disabled")&&t.push($j(this).attr("name"))}),t.length&&(n.erroneously_submitted_fields=t.join(" ")),n}}(jQuery),csui=function(){var s={},i=null;function o(e,n){var t,i,r=new Object;for(t in e)"string"==typeof t&&"function"!=typeof e[t]&&(i=0<n.length?n+"["+t+"]":t,"object"==typeof e[t]?r=jQuery.extend(!1,r,o(e[t],i)):r[i]=e[t]);return r}function r(e){var n={},n=jQuery(e).mki_form_as_json();return current_ssid&&(n["ssid[number]"]=current_ssid.number),jQuery.isFunction(s.subtab.subtab_form_data)&&(e=o(s.subtab.subtab_form_data(n),""),jQuery.extend(n,e)),n}function a(){var n,e=document.forms.namedItem("client_vpn_settings_edit_form"),t=new FormData(e);return current_ssid&&t.append("ssid[number]",current_ssid.number),jQuery.isFunction(s.subtab.subtab_form_data)&&(n=o(s.subtab.subtab_form_data(),""),_.each(_.keys(n),function(e){t.append(e,n[e])})),t}function c(e){nodegroup_settings=e.nodegroup_settings,ssids=e.ssids,access_policies=e.access_policies,e.wdc&&(wdc=e.wdc),e.switch_configs&&(switch_configs=e.switch_configs),ssids&&jQuery.each(ssids,function(e,n){ssids_by_number[n.number]=n}),e.access_policies_auth&&jQuery.each(e.access_policies_auth,function(e,n){ssids_by_number[n.number]=n})}function u(){jQuery.remove_top_status(),window.scrollTo(0,0),hQuery(".configure_form").show(),hQuery(".configure_subtab_loading").hide()}function d(){0!=jQuery("#confirm_changes_input").length&&jQuery("#confirm_changes_input").remove(),u(),jQuery(document).trigger("configure_ready")}function l(){$j("form.configure_form").trigger("config_error.configurejs")}function n(){hQuery("form.configure_form").bind("submit.configurejs",function(){if(function(){var e=jQuery("input[name$='_preventSubmit']");if(0<e.length){e=e[0].value;return alert(e),l(),1}}())return!1;if(!function(){var e=jQuery("input[name$='_unfinishedChangeConfirmation']");if(0<e.length){e=e[0].value;if(!confirm(e))return void l()}return 1}())return!1;jQuery("form.configure_form input:submit").blur();var e,n,t,i=(t=new Array,t="function"==typeof s.subtab.client_side_configuration_errors?t.concat(s.subtab.client_side_configuration_errors()):t);if(i.length){for(n="Error:\n",e=0;e<i.length;e++)n+="- "+i[e].message+"\n";alert(n)}else hohelp(),hQuery("#save_notice_container").empty(),window.scrollTo(0,0),jQuery.remove_top_status(),hQuery(".configure_subtab_loading").html("<br/><br/>").show(),jQuery.top_status({box_class:"working",content:baseline_spinner_html()+" Saving..."}),hQuery(".configure_form").hide(),change_tracker.pack_changes(),("client_vpn_settings_edit_form"===$j(this).attr("name")&&"multipart/form-data"===$j(this).attr("enctype")?$j.ajax({type:"POST",url:$j(this).attr("action"),data:a(),processData:!1,contentType:!1,xhrFields:{withCredentials:!0}}):$j.post($j(this).attr("action"),r($j(this)))).done(g).fail(f);return!1})}var b=[],p=null;function g(e,n){var t,i,r=e.update_messages;if(void 0!==r.errors&&0<r.errors.length?(t="bad",i="There were errors in saving this configuration: <ul><li>"+_.map(r.errors,_.escape).join("</li><li>")+"</li></ul>"):void 0!==r.confirmations&&0<r.confirmations.length?(t="confirm",i="The settings you requested require confirmation.  Please review the following list.",i+="<ul><li>"+_.map(r.confirmations,_.escape).join("</li><li>")+"</li></ul>"):(t="good",void 0!==r.warnings&&0<r.warnings.length?i="Changes saved. There were warnings in saving this configuration: <ul class='top_status_list'><li>"+_.map(r.warnings,_.escape).join("</li><li>")+"</li></ul>":(i=r.success_message?_.escape(r.success_message):"Changes saved.","undefined"!=typeof splash_csui&&splash_csui.update_static_vars(e.new_settings))),jQuery.each(b,function(e,n){jQuery(n).attr("title","").parent().removeClass("fieldWithErrors")}),b=[],void 0!==r.extra_error_data)for(element_name in r.extra_error_data)el_selector='[name="'+element_name+'"]',jQuery(el_selector).attr("title",r.extra_error_data[element_name]).parent().addClass("fieldWithErrors"),b.push(el_selector);"good"==t?(e.new_settings&&(c(e.new_settings),Mkiconf.has_wired?current_vlan&&(current_vlan=wdc.vlans_enabled?_.findWhere(wdc.wired_vlans,{vlan_id:current_vlan.vlan_id}):wdc.single_lan,current_ssid=current_ssid&&current_vlan.access_control_setting):current_ssid=current_ssid&&ssids_by_number[current_ssid.number]),jQuery.isFunction(s.subtab.submit_success)&&s.subtab.submit_success(e,n),e.new_settings&&current_ssid&&v(current_ssid.number,current_vlan)):"bad"==t&&jQuery.isFunction(s.subtab.submit_error)&&s.subtab.submit_error(e,n),hQuery("form.configure_form").trigger("submit_success.configurejs",[e]),d(),"confirm"==t?(i+="<div class='confirm_button_container'>\n  <input id='confirm_button' type='button' value='Confirm Changes' />\n  <input id='cancel_button' type='button' value='Cancel' />\n</div>",jQuery("form.configure_form").dim(),jQuery(".confirm_button_container").show(),p=change_tracker.hide_box(),change_tracker.hide_box(!0)):(jQuery("form.configure_form").undim(),jQuery(".confirm_button_container").hide(),null!==p&&change_tracker.hide_box(p)),"good"==t?(jQuery.top_status({box_class:t,content:i,fade_out:0,user_closeable:!0}),$(".password_toggle").removeClass("password_plaintext password_obscured"),$(".password_toggle :text:not([readonly])").val("")):(jQuery.top_status(),hQuery("#save_notice_container").html("<div class='notice_explanation_container'><div data-testid='notice-explanation-"+t+"'class='notice_explanation "+t+"'>"+i+"</div></div>"),0!=jQuery(".confirm_button_container").length&&(jQuery(".confirm_button_container #confirm_button").click(h),jQuery(".confirm_button_container #cancel_button").click(m)))}function f(e,n,t){var i="";"not logged in"==e.responseText?(i="Settings could not be saved because your session expired.  You will be logged out in 5 seconds.",setTimeout("window.location = Mkiconf.logout_url;",5e3)):"password expired"==e.responseText?(i="Settings could not be saved because you need to change your password. You will be redirected to a new page in 5 seconds.",setTimeout(function(){window.location=url_for({controller:"users",action:"change_password"})},5e3)):"need sms auth"==e.responseText?(i="Settings could not be saved because you need to set up SMS authentication. You will be redirected to a new page in 5 seconds.",setTimeout(function(){window.location=url_for({controller:"users",action:"sms_auth_config"})},5e3)):"unauthorized ip"==e.responseText?(i="Settings could not be saved because your session expired. You will be logged out in 5 seconds.",setTimeout("window.location = Mkiconf.unauthorized_ip_url;",5e3)):"locked ip session"==e.responseText?(i="Settings could not be saved because your session expired. You will be logged out in 5 seconds.",setTimeout("window.location = Mkiconf.locked_ip_session_url;",5e3)):i="Settings could not be saved.  Please verify that your connection is working and try again.",hQuery("#save_notice_container").html("<div class='notice_explanation_container'><div class='notice_explanation bad' data-testid='error-notice'>"+i+"</div></div>"),hQuery("form.configure_form").trigger("submit_error.configurejs",[t,i]),u()}function h(){return 0==jQuery("#confirm_changes_input").length&&jQuery(".configure_form").prepend("<input type='hidden' id='confirm_changes_input' name='confirm_changes_input' value='changes confirmed' />"),jQuery(".configure_form").trigger("submit.configurejs"),!1}function m(){jQuery("form.configure_form").undim(),jQuery(".confirm_button_container").hide(),null!==p&&change_tracker.hide_box(p),hQuery("#save_notice_container").empty(),window.scrollTo(0,0),jQuery.remove_top_status()}function w(e,n){var t;t=e,current_ssid&&(i&&i.abort(),i=$j.post(change_ssid_url,{ssid:t}).always(function(){i=null})),v(e),d(),n&&n()}function e(){}function v(e,n){if(ssids.length||access_policies.length){if(current_ssid&&(jQuery(document).unbind("change_tracker_reset"),jQuery.isFunction(s.subtab.ssid_dinit)&&s.subtab.ssid_dinit()),!n){if(!(current_ssid=ssids_by_number[e]))return void(s.ssid_in_path?window.location.href=y(e):window.location.search=put_param_in_search("ssid_number",e));s.ssid_in_path?window.history.replaceState(null,null,y(e)):window.history.replaceState(null,null,put_param_in_search("ssid_number",e))}"sms"==current_ssid.open_access_policy&&""!=Mkiconf.twilio_auth_warning?(jQuery("#twilio_warning").html(Mkiconf.twilio_auth_warning),jQuery("#twilio_warning").show()):jQuery("#twilio_warning").hide(),jQuery("#facebook_warning").hide(),$("#fb_splash_reset input").unbind("click"),$("#create_fb_splash_exception input").unbind("click"),"facebook"==current_ssid.open_access_policy&&current_ssid.fb_gw_id&&!current_ssid.fb_page_name&&(t="<a target='_blank' href=https://www.facebook.com/wifiauth/config/?gw_id="+current_ssid.fb_gw_id+">here</a>",fb_text="Click "+t+" to finish configuring your Facebook Wi-Fi settings<br />",jQuery("#facebook_warning").html(fb_text),jQuery("#facebook_warning").show());var t=current_ssid.availability_tags.split(" ")||[];return $j("#ssid_available_some_aps").val(t).trigger("chosen:updated"),s.subtab.ssid_init(current_ssid,s),change_tracker&&change_tracker.reset(),1}setTimeout(function(){v(e)},200)}function y(e){var n=new URL(window.location.href),e=url_for({controller:Mkiconf.controller_name,action:Mkiconf.action_name,id:e.toString()});return n.pathname=e,n.searchParams.delete("ssid_number"),n}return e.bind_submit_handler=n,e.unbind_submit_handler=function(){hQuery("form.configure_form").unbind("submit.configurejs")},e.current_ssid=function(){return current_ssid},e.current_vlan=function(){return current_vlan},e.init=function(e){if(s={subtab:!1,config:!1,settings_url:"/configure/settings"},e&&jQuery.extend(s,e),!s.subtab)throw new Error("invalid subtab");var t;hQuery(".configure_form").hide().after('<div class="configure_subtab_loading">Loading...</div>'),s.config?c(s.config):$j.getJSON(s.settings_url).done(c),$(".configure_form input:text").keypress(function(e){13==e.keyCode&&e.preventDefault()}),n(),s.subtab.init(e),s.has_ssid_selector&&hQuery("#select_ssid").change(function(){var e=this;if(change_tracker&&0<change_tracker.count()&&!confirm(confirm_unsaved_msg))return $j(e).val(current_ssid.number),!1;$("#hover_help_container").hide(),w($j(e).val(),function(){$j(e).blur()})}).triggerHandler("change"),Mkiconf.has_wired&&s.setup_mx_vlan&&(e=urlHash.getState("vlan"),wdc.vlans_enabled?(e?current_vlan=_.findWhere(wdc.wired_vlans,{vlan_id:parseInt(e)}):(current_vlan=wdc.wired_vlans[0],urlHash.pushState({vlan:current_vlan.vlan_id})),s.has_vlan_selector&&((t=$j("#vlan_selector")).val(current_vlan.vlan_id),t.change(function(e){var n=parseInt(t.val());n!=current_vlan.vlan_id&&(urlHash.pushState({vlan:n}),t.trigger("new_vlan_selected"),$j("#vlan_spinner").show(),document.location.reload(!0))}),t.closest("div").show())):(current_vlan=wdc.single_lan,e&&urlHash.removeState("vlan")),$j("#hidden_wired_vlan_id_input").val(current_vlan.vlan_id),current_ssid=current_vlan.access_control_setting,v(-1,!0)),change_tracker({toggle:!0,highlight:".save_button_container",send_with_form:!0}),jQuery(document).trigger("change_tracker_reset"),d()},e.subtab_form_data=r,e}(),jQuery.fn.m_build_bandwidth_widget=function(e){var a,e=jQuery.extend({container:jQuery(this),bw_slider_notches:[[50,"50 Kbps"],[100,"100 Kbps"],[250,"250 Kbps"],[500,"500 Kbps"],[1024,"1 Mbps"],[2048,"2 Mbps"],[5120,"5 Mbps"],[10240,"10 Mbps"],[25600,"25 Mbps"],[51200,"50 Mbps"],[102400,"100 Mbps"],[0,"unlimited"]],unique_id:jQuery(this).attr("id"),hidden_input:!1,new_class:!1},e);return a=jQuery.extend({simple:!0,in_mbps:!1,bw_limit_enabled:!1,bw_up:0,bw_down:0,bursting_enabled:!1,show_bursting_checkbox:!1,advanced_upload_validators:[],advanced_download_validators:[]},e),_.init=function(e){jQuery.extend(a,e),a.bw_limit_enabled=0<a.bw_up||0<a.bw_down,!a.simple||!a.bw_limit_enabled||a.bw_up==a.bw_down&&r(a.bw_up/1024)||(a.simple=!1);e='<table><tr><td><div class="simple" style="display:none">  <div style="padding-bottom:8px" class="slider_text">&nbsp;</div>  <div class="slider" style="width:100px"></div></div></td><td><table class="advanced" style="display:none">  <tr>    <td style="font-size: 0.8em">down (Kb/s)</td>    <td>      <input class="input_down" size="10" style="text-align: right; font-size: 0.8em" type="tel"/>    </td>    <td class="bw_error_down" style="font-size: 0.8em; color:red; display:none"></td>  </tr>  <tr>    <td style="font-size: 0.8em">up (Kb/s)</td>    <td>      <input class="input_up" size="10" style="text-align: right; font-size: 0.8em" type="tel" />    </td>    <td class="bw_error_up" style="font-size: 0.8em; color:red; display:none"></td>  </tr></table></td><td style="font-size:0.8em; padding-left: 1em">  <a class="bandwidth_widget_toggle" href="#"></a></td>';a.in_mbps&&(e=e.replace(/Kb/g,"Mb")),a.show_bursting_checkbox&&(e+='<td class="" style="padding-left:2em"><div class="bursting_checkbox_container" style="position:relative"><input type="checkbox" class="bursting_checkbox" id="bursting_checkbox_'+a.unique_id+'" /> <label id="bursting_checkbox_label_'+a.unique_id+'" class="bursting_checkbox_label" for="bursting_checkbox_'+a.unique_id+'">Enable SpeedBurst</label></div></td>'),a.container.html(e+="</tr></table>"),a.slider=a.container.find(".slider").slider({min:0,max:a.bw_slider_notches.length-1,step:1,stop:s,slide:s}),a.container.find(".input_up, .input_down").bind("keyup change",o),a.container.find(".bandwidth_widget_toggle").click(function(){return t(!a.simple),!1}),n(),$(document).bind("change_tracker_reset",n),a.show_bursting_checkbox&&a.container.find(".bursting_checkbox").prop("checked",a.bursting_enabled).change(function(){var e=a.container.find(".bursting_checkbox").is(":checked");change_tracker.change(a.unique_id+"_bursting_enabled",e)}),t(a.simple),a.show_bursting_checkbox&&dashhelp("bandwidth_bursting","#bursting_checkbox_label_"+a.unique_id),a.hidden_input&&(a.container.on("change",_.record),_.record())},_.record=function(){var e;a.hidden_input&&(e=a.container.data("bw"))&&function(e){var n,t=$j(this);for(p in e)n=[".",p,":input"].join(""),t.find(n).val(e[p]).trigger("change")}.apply($j(e)[0],[_.state()])},_.cleanup=function(){},_.state=function(){var e={simple:a.simple,bw_up:a.bw_up,bw_down:a.bw_down,bw_limit_enabled:a.bw_limit_enabled};return a.show_bursting_checkbox&&(e.bursting_enabled=a.container.find(".bursting_checkbox").is(":checked")),e},_.destroy=function(){a.container.children().remove()},_.toggle=function(e,n){n=!(1<arguments.length)||n,a.container.toggle(e),e&&a.container.find(".bursting_checkbox_container").toggle(n)},_.set_unique_id=function(e){a.unique_id=e},_;function _(){}function n(){change_tracker.track(a.unique_id+"_bw_limit_enabled",a.bw_limit_enabled),change_tracker.track(a.unique_id+"_bw_up",a.bw_up),change_tracker.track(a.unique_id+"_bw_down",a.bw_down)}function t(e){a.simple=e,a.container.find(".simple").toggle(a.simple),a.container.find(".advanced").toggle(!a.simple),a.container.find(".bandwidth_widget_toggle").text(a.simple?"details":"simple"),e?(pos=a.bw_limit_enabled?a.bw_up==a.bw_down&&r(a.bw_up/1024)?i(a.bw_up/1024):-1:a.bw_slider_notches.length-1,a.slider.slider("value",-1==pos?3:pos),s(0,{value:pos})):("custom"!=a.container.find(".slider_text").text()&&(e=a.in_mbps?1048576:1024,a.container.find(".input_down").val(a.bw_down/e),a.container.find(".input_up").val(a.bw_up/e)),a.container.find(".bw_error_up, .bw_error_down").hide())}function i(e){a.in_mbps&&(e/=1024);for(var n=0;n<a.bw_slider_notches.length;n++)if(a.bw_slider_notches[n][0]==e)return n;return 0}function r(e){return 0!=i(e)}function s(e,n){var t=n.value,n=a.container.find(".slider_text");if(-1==t)return a.bw_limit_enabled=!0,void n.text("custom");0==a.bw_slider_notches[t][0]?(a.bw_limit_enabled=!1,n.text("unlimited"),a.container.find(".bursting_checkbox_container").dim()):(a.bw_limit_enabled=!0,n.text(a.bw_slider_notches[t][1]),a.container.find(".bursting_checkbox_container").undim());n=a.in_mbps?1048576:1024;a.bw_up=a.bw_down=a.bw_slider_notches[t][0]*n,a.container.trigger("change.bandwidth",[_.state()]),a.container.change(),change_tracker.change(a.unique_id+"_bw_limit_enabled",a.bw_limit_enabled),change_tracker.change(a.unique_id+"_bw_up",a.bw_up),change_tracker.change(a.unique_id+"_bw_down",a.bw_down)}function o(){var e,n,t=parseFloat(a.container.find(".input_up").val()),i=parseFloat(a.container.find(".input_down").val()),r=a.advanced_upload_validators.concat([c]),s=a.advanced_download_validators.concat([c]),o=!0;for(a.container.find(".bw_error_up, .bw_error_down").hide(),e=0;e<r.length;e++)if(n=r[e](t)){a.container.find(".bw_error_up").text(n).show(),o=!1;break}for(e=0;e<s.length;e++)if(n=s[e](i)){a.container.find(".bw_error_down").text(n).show(),o=!1;break}o&&(a.bw_up=1024*t,a.bw_down=1024*i,a.in_mbps&&(a.bw_up*=1024,a.bw_down*=1024),a.bw_limit_enabled=0<t||0<i,a.container.trigger("change.bandwidth",[_.state()]),change_tracker.change(a.unique_id+"_bw_limit_enabled",a.bw_limit_enabled),change_tracker.change(a.unique_id+"_bw_up",a.bw_up),change_tracker.change(a.unique_id+"_bw_down",a.bw_down)),a.container.find(".bursting_checkbox_container").dim(!a.bw_limit_enabled)}function c(e){if(isNaN(e))return"Please enter a number."}};