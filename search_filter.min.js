/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(i,u){var s={timeout:200,searchbox:"input.smart_search",urlState:"q"};window.SearchFilter=function(t){var e=this;e.queryTerm="",e.data=[],e.results=[],u.defaults(t=t||{},s),e.options=t,e.searchbox=i(t.searchbox),e.container=e.searchbox.parent(),e.filter=t.filter,t.filter_fn&&(e.filter=make_smart_filter(),t.filter_fn(e.filter)),u.bindAll(e,"setData","setQueryTerm","runNow","_updateUrlHash","_setTermFromHash","_setResults","_setupEvents","_setupDropdown","_updateFromDropdown","allMatched","checkboxHTML","noMatches"),e.run=u.debounce(e.runNow,e.options.timeout),e.dropdown=e.container.children(".dropdown-widget"),e.dropdown.is("*")&&e._setupDropdown(),e.options.urlState&&(e._setTermFromHash(),i(window).on("hashchange",e._setTermFromHash)),e.options.data&&e.setData(e.options.data),e._setupEvents()};var t={setData:function(t){this.data=u.isArray(t)?t:u.values(t),i(this).trigger("change:data",[this.data]),this.run()},updateData:function(n,r){u.isEmpty(this.data)||(r=r||{},u.defaults(r,{key_name:"id",scan_to_find:u.isArray(n),preserved_fields:["checked"]}),u.each(this.data,function(e){var t,s=null;(s=r.scan_to_find?((t={})[r.key_name]=e[r.key_name],u.findWhere(n,t)):n[e[r.key_name]])&&u.each(r.preserved_fields,function(t){s[t]=e[t]})})),this.setData(n)},setQueryTerm:function(t,e){this.queryTerm!==t&&(this.queryTerm=t,this.searchbox.val()!==t&&this.searchbox.val(t),this._updateUrlHash(),e?this.runNow():this.run())},addSingletonQueryTerm:function(t,e){0<=(this.queryTerm||"").indexOf(t+":")||(e=u.compact([this.queryTerm,t+":"+e]).join(" "),this.setQueryTerm(e))},runNow:function(){var t=this.options.additional_terms?this.options.additional_terms()+" "+this.queryTerm:this.queryTerm,t=(""===t?this.data:this.filter(this.data,t).items)||[];this._setResults(t)},_updateUrlHash:function(){var t,e=this.options.urlState,s=this.queryTerm;e&&(u.isEmpty(s)?urlHash.removeState(e):((t={})[e]=s,urlHash.pushState(t)))},_setTermFromHash:function(){var t=urlHash.getState(this.options.urlState)||"";this.setQueryTerm(t)},_setResults:function(t){this.results=t,i(this).trigger("change:results",[this.results,this.noMatches()])},allMatched:function(){return this.data.length===this.results.length},noMatches:function(){return 0===this.results.length&&this.data.length!==this.results.length},_setupEvents:function(){var s=this;s.searchbox.on("keydown input",function(t){var e=!1;13===t.keyCode&&(t.preventDefault(),e=!0),s.setQueryTerm(i(this).val(),e)}).focus(function(){s.container.addClass("focused")}).blur(function(){s.container.removeClass("focused")})},checkboxHTML:function(t,e){var s=u.uniqueId("filter_check_");return["<input id='"+s+"' class='filter_check' type='checkbox' checked='checked' data-keyword='"+t+"'/>","<label for='"+s+"'>"+e+"</label>"].join("&nbsp;")},_setupDropdown:function(){var e=this;e.dropdown.on("keyup input","input[type='search']",this._updateFromDropdown).on("change","select",this._updateFromDropdown).on("change","input:checkbox",function(){var t=i(this);e.setQueryTerm(e.filter.change_checkbox(e.queryTerm,t.data("keyword"),t.is(":checked")))}).on("click",function(t){t.stopPropagation()}).find(".chosen-select").chosen(),this.searchbox.on("keydown",function(t){40===t.keyCode&&(e.container.addClass("open"),e.dropdown.find("input:first").focus())}),i(document).on("keydown",function(t){27===t.keyCode&&e.container.hasClass("open")&&(e.container.removeClass("open"),e.searchbox.focus())})},_updateFromDropdown:function(){var o=[];this.dropdown.find("input[type='search'], select").each(function(t,e){var s,n=i(e),e=n.val(),r=n.attr("data-search-tag"),a=n.hasClass("noquotes")?"":'"',r=r?r+":":"";u.isArray(e)&&(e=u.compact(e)),u.isEmpty(e)||(u.isArray(e)?s="("+u.map(e,function(t){return r+a+t+a}).join(" OR ")+")":u.isString(e)&&(s="("+u.map(e.split(/\b(AND|OR|NOT)\b/),function(t){return"OR"===(t=t.trim())||"AND"===t||"NOT"===t?t:r+t})+")"),o.push(s))}),this.setQueryTerm(o.join(" AND "))}};SearchFilter.prototype=t}(jQuery,_);