/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
var l3_changes={};function make_change_log_table(e,t){var n={cl_time:{l:"Time (UTC)",r:"[%= l3_changes.render_time(item) %]",sort_by:"time",sorter:"#",revsort:!0},cl_admin:{l:"Admin",render:"[%= _.escape(item.admin_name || item.admin_email) %]</a>",filter_by:"admin",sort_by:"admin_name",text:"[%= _.escape(item.admin_name || item.admin_email) %]"},cl_oauth_client_id:{l:"Oauth client id",render:"[%= _.escape(item.oauth_client_id) %]",filter_by:"oauth_client_id",sort_by:"oauth_client_id"},cl_network:{l:"Network",render:"[%= l3_changes.render_network(item.network_name, item.network_url_tag, item.network_encrypted_id) %]",filter_by:"network",sort_by:"network_name",text:"[%= _.escape(item.network_name) %]"},cl_ssid:{l:"SSID",render:"[%= _.escape(item.ssid_name) %]",filter_by:"ssid",sort_by:"ssid_name"},cl_category:{l:"Page",render:"[%= _.escape(item.category) %]",filter_by:"page",sort_by:"category"},cl_label:{l:"Label",render:"[%= _.escape(item.label) %]",filter_by:"label",sort_by:!1},cl_old_value:{l:"Old value",r:a("old"),sort_by:!1,text:"[%= replace_double_quotes_for_csv(item.old_text) %]"},cl_new_value:{l:"New value",r:a("new"),sort_by:!1,text:"[%= replace_double_quotes_for_csv(item.new_text) %]"}};function a(l){return function(e){if("complex"===e.format)try{var t=JSON.parse(e.old_text),n=JSON.parse(e.new_text);if(_.isArray(n)&&_.isArray(t)){var a="old"===l?[t,n,"Removed"]:[n,t,"Added"],r=_.difference(a[0],a[1]);if(!_.isEmpty(r))return l3_changes.render_change_value(function(e,t){var n="";_.isEmpty(e)||(n=_.escape(t)+":&nbsp;");(1<_.size(e)||_.isObject(e[0]))&&(n+="<br/><br/>");return n+=i(e)}(r,a[2]))}else if(_.isObject(n)&&_.isObject(t))return l3_changes.render_change_value(o("old"===l?t:n))}catch(e){}else if("pretty_json"===e.format)try{return l3_changes.render_change_value(function(e){e=JSON.stringify(JSON.parse(e),null,2).split("\n");return _.map(e,function(e){return'<span style="white-space: pre;">'+_.escape(e)+"</span>"}).join("<br/>")}("old"===l?e.old_text:e.new_text))}catch(e){}return text="old"===l?e.old_text:e.new_text,parsedText=function(e){const t=/\r\n|\n/;return t.test(e)?e.split(t):e}(text),Array.isArray(parsedText)?l3_changes.render_change_value(i(parsedText)):_.escape(text)}}function i(e){return _.map(e,function(e){return _.isObject(e)?o(e):_.escape(e)}).join("<br/>")}function o(e){var n=[];return _.each(e,function(e,t){n.push('<ul style="padding: 0 0 0 8px; list-style-type: none">'),_.isArray(e)?(n.push("<li>"+_.escape(t)+"<ul>"),(n=n.concat(_.map(e,function(e){return _.isObject(e)?o(e):"<li>"+_.escape(e)+"</li>"}))).push("</ul></li>")):_.isObject(e)?(n.push("<li>"+_.escape(t)+"<ul>"),(n=n.concat(o(e))).push("</ul></li>")):(e=120<(""+e).length?(""+e).substring(0,120)+"...":e,n.push("<li>"+_.escape(t)+": "+_.escape(e)+"</li>")),n.push("</ul>")}),n.join("")}e=setup_changes_search_filter(e);window.flex_table=make_flex_table({container:"#changes_table",addons:["hotkeys"],columns:n,selected_fields:["cl_time","cl_admin","cl_oauth_client_id","cl_network","cl_ssid","cl_category","cl_label","cl_old_value","cl_new_value"],default_sort:"cl_time",footer:!0,className:"compact fill",row_id_prefix:!0,no_items_html:"No logged configuration changes.",no_matches_html:"No matching configuration changes.",items_per_page:30,row_class_template:"fth[%= index % 2 %][%= item.show_meraki_admin_highlighting ? ' ' + 'adminhighlight' : '' %]",search_filter:e,loading:t&&t.loading})}function make_mki_changes_filter(){var n=make_smart_filter();return n.addkw({"":function(e,t,n,a){return[a.getkw("label")(e,t,n,a),a.getkw("time")(e,t,n,a),a.getkw("admin")(e,t,n,a),a.getkw("network")(e,t,n,a),a.getkw("ssid")(e,t,n,a),a.getkw("page")(e,t,n,a),a.getkw("new-value")(e,t,n,a),a.getkw("old-value")(e,t,n,a),a.getkw("oauth-client-id")(e,t,n,a)].join("||")},admin:function(e,t){return n.propmatch("admin_name",e,t,!1)+"||"+n.propmatch("admin_email",e,t,!1)},time:function(e,t){return n.propmatch("time_str",e,t,!1)},network:function(e,t){return n.propmatch("network_name",e,t,!1)},ssid:function(e,t){return n.propmatch("ssid_name",e,t,!1)},page:function(e,t){return n.propmatch("category",e,t,!1)},label:function(e,t){return n.propmatch("label",e,t,!1)},"old-value":function(e,t){return n.propmatch("old_text",e,t,!1)},"new-value":function(e,t){return n.propmatch("new_text",e,t,!1)},"oauth-client-id":function(e,t){return n.propmatch("oauth_client_id",e,t,!1)}}),n}function setup_changes_search_filter(e){var a;t(0,e),window.load_more_changes=function(){var e=$j(".search_count a[href='#load_more']").hide(),t=$j(".search_count .spinner").show();const n={older_than:oldest_change,load_aggressively:!0},a=new URLSearchParams(window.location.search);var r=a.get("newer_than"),l=a.get("older_than");return r&&(n.newer_than=r,n.load_aggressively=!1),l&&(n.older_than=l),$j.ajax({type:"GET",dataType:"json",url:url_for({controller:"organization",action:"more_changes"}),data:n,success:function(e){e&&(changes=changes.concat(e.changes),oldest_change=e.oldest_change,limit_hit=e.limit_hit,i.setData(changes))},complete:function(){e.show(),t.hide()}}),!1};var i=new SearchFilter({data:e,filter:make_mki_changes_filter()});return i.dropdown.off("change","input:checkbox").on("change","input:checkbox",function(){$(this).is(":checked")?$("#page_search").val("via*api").attr("disabled","disabled"):$("#page_search").val("").removeAttr("disabled"),$("#page_search").trigger("input")}),$j(i).on("change:data",t).on("change:results",function(e,t){var n;n="<span class='result'>"+pluralized_phrase(t.length,"change","changes")+"</span>",a.count!==t.length&&(n+=" in "+pluralized_phrase(a.count,"change","changes"));oldest_change&&(n+=" dating back to <span class='notranslate'>"+unparse_date(oldest_change,"%b %-d %#Y",1)+"</span>");limit_hit&&(n+=" <a href='#load_more'>load more changes</a>",n+="<img class='spinner' src='"+Mkiconf.images+"spinner.gif' alt='Running...' style='display:none' />");i.container.siblings(".search_count").html(n)}),$j(document).on("click","a[href='#load_more']",load_more_changes),i.runNow(),i;function t(e,t){_.isArray(t)||(t=_.values(t)),a={count:t.length}}}function init_csv_download_button(){$("#changes_csv_download").on("click",function(e){if(e.preventDefault(),0===flex_table.items().length)return flex_table.loading?$.top_status({box_class:"bad",content:"Please try again when the data finishes loading."}):$.top_status({box_class:"bad",content:"There is no data to download."});e=_.without(_.keys(flex_table.columns),"row_num"),e=object_to_csv(flex_table.items(),flex_table.columns,e,{encode:!1}),e=new Blob([e],{type:"text/csv;charset=utf-8"});saveAs(e,"download.csv")})}l3_changes.render_time=function(e){return new timezoneJS.Date(1e3*parseInt(e.time,10),"UTC").toString("MMM dd, yyyy HH:mm")},l3_changes.render_network=function(e,t,n){return null==e||0==e.length?"":t&&n?"<a href='"+url_for_node_group({tag:t,eid:n})+"'>"+_.escape(e)+"</a>":_.escape(e)},l3_changes.render_change_value=function(e){if(!e||"string"!=typeof e)return e;var r="&lt;&lt; hide",t=_.compact(e.split("<br/>")),n="",a=t.length-4+1;if(t.length<=4)return e;for(var l=0;l<3;l++)n+="<span>"+t[l]+"</span><br/>";for(n+="<div class='hidden_values' num='"+a+"'>",l=3;l<t.length;l++)n+="<div>"+t[l]+"</div>";return n+="</div>",n+="<div>&nbsp;&nbsp;<span class='value_column_toggle_link'>"+(a+" more &gt;&gt;")+"</span></div>",l3_changes.more_links_bound||($j("#changes_table").on("click","span.value_column_toggle_link",function(e){var t=$j(this),n=t.parent().siblings("div.hidden_values"),a=t.html()===r;return n.toggle(),a?t.html(n.attr("num")+" more &gt;&gt;"):t.html(r),!1}),l3_changes.more_links_bound=!0),n};