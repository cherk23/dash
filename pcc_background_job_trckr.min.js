/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(k){window.Mkijson=window.Mkijson||{},window.Mkijson.pcc_background_jobs=window.Mkijson.pcc_background_jobs||{},window.PccBackgroundJobTracker=function(o){var n=this;o=o||{},_.defaults(o,{extra_params:{}});o.on_jobs_completed,o.on_jobs_status_changed;var c=!1,r={},t=o.job_status_url,a=o.extra_params;if(!t)throw"job_status_url was not provided";function s(c){_.each(c,function(o,n){_.isObject(o)||(c[n]={id:o})}),e(c),_.any(c,b)&&u()}function e(o){var c=[],t=[];_.each(o,function(o){var n;(r[o.id]?r[o.id].status:null)!=o.status?(c.push(o),(n=Mkijson.pcc_background_jobs[o.id])?(_.extend(n,o),b(o)||t.push(o)):Mkijson.pcc_background_jobs[o.id]=o):_.has(Mkijson.pcc_background_jobs,o.id)||(Mkijson.pcc_background_jobs[o.id]=o),r[o.id]=o}),0<c.length&&k(n).trigger("jobs_status_changed",[c]),0<t.length&&(_.each(t,function(o){delete r[o.id]}),k(n).trigger("jobs_completed",[t]))}function i(){return _.select(Mkijson.pcc_background_jobs,b)}var u=_.debounce(function(){c||d()},3e3);function d(){c=!0,k.ajax({url:t,type:"POST",crossDomain:!0,xhrFields:{withCredentials:!0},data:_.extend(a,{job_ids:_.pluck(i(),"id")}),success:function(o){e(o),_.any(o,b)||_.any(r,b)?_.delay(d,3e3):c=!1}})}function b(o){return o&&"complete"!=o.status&&"failed"!=o.status}PccBackgroundJobTracker.prototype.track_jobs=s,PccBackgroundJobTracker.prototype.track_job=function(o){s([o])},PccBackgroundJobTracker.prototype.running_jobs=i,PccBackgroundJobTracker.prototype.poke=function(){s(i())},PccBackgroundJobTracker.prototype.any_jobs_running=function(){return _.isEmpty(r)}}}(jQuery);