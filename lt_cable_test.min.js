/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(l){var n;function a(t,e,s){t.find(".ltplay, .ltstop").attr("class","ltstop").attr("alt","Stop"),n?lt_cable_test.stop(t):function(e,s,r){var t;t=r?r.toString():function(t){t=t.filter("#cable_test_ports").val();{if(!t||!t.match(/^(?:\s*\d+\s*|\s*\d+\s*-\s*\d+\s*)(?:,(?:\s*\d+\s*|\s*\d+\s*-\s*\d+\s*))*$/))return alert('Please provide the ports on which you would like to run the test.  You can provide a single port, comma-separated list of ports, a range of ports, or a combination of those.  For example, "1, 2, 11-15"'),null;if(function(t){var e=switch_details.uplink_port;if(!e)return!1;for(var s=0;s<t.length;s++)if(t[s]){var r=t[s].match(/^\s*(\d+)\s*-\s*(\d+)\s*$/);if(r&&parseInt(r[1])<=e&&parseInt(r[2])>=e)return!0;if((r=t[s].match(/^\s*(\d+)\s*$/))&&parseInt(r[1])===e)return!0}return!1}(t.match(/\d+\s*-\s*\d+|\d+/g)))return alert("You are not allowed to run the cable test on your uplink port because it may interrupt the connection to the switch."),null}return t}(e);t?(n=l.comet.command_subscribe({broker:"CableTest",ports:t},function(t){!function(t,e,s,r){var n=[];t.data&&t.data.ports&&(n=t.data.ports);s.set_items(n),lt_cable_test.stop(e),l(r?"#cable_test_indiv_port":"#cable_test").show()}(t,e,s,r)}),e.find(".spinner").show(),l("#cable_test").hide(),live_toolbox.set_tool_status(lt_cable_test,!0)):e.find(".ltplay, .ltstop").attr("class","ltplay").attr("alt","Go")}(t,e,s)}function o(t){for(var e=["port_num","link","length","status"],s={port_num:{l:"Port",render:"[%= switch_details.render_port(item.port) %]",sort_by:"port",sorter:"#"},link:{l:"Link speed",render:"[%= item.curlink %]",sort_by:"curlink"},status:{l:"Status",render:"[%= lt_cable_test.render_status(item) %]",sort_by:i},length:{l:"Length "+dimtext("(Â± 3m)"),render:"[%= lt_cable_test.render_length(item) %]",sort_by:_}},r=1;r<=4;r++)e.push("pair"+r),s["pair"+r]={l:"Pair "+r,render:"[%= lt_cable_test.render_pair_status(item, "+r+") %]",sort_by:!1};return make_flex_table({container:t,row_id_prefix:!0,row_num:!1,selected_fields:e,default_sort:"port_num",columns:s,items:[],className:"compact",footer:!0,items_per_page:52,no_items_html:"No results to report"})}function i(t){return lt_cable_test.render_status(t)}function _(t){return"down"===t.curlink?-1:(t.len0+t.len1+t.len2+t.len3)/4}function c(t){return("down"!==t.curlink||"1:open"!==t.st0||"1:open"!==t.st1||"1:open"!==t.st2||"1:open"!==t.st3)&&"sfp"!==t.curlink}window.lt_cable_test={},lt_cable_test.init=function(t){var e=l("#lt_cable_test_tmpl").tmpl().appendTo(t),s=o("#cable_test");e.find(".ltplay").click(function(){a(e,s)}),e.filter("#cable_test_ports").on("keypress",function(t){13===t.keyCode&&a(e,s)}),dashhelp("cable_test")},window.init_port_cable_test=function(e){var s=l("#port_cable_test"),r=o("#cable_test_indiv_port");s.find(".ltplay").off("click"),s.find(".ltplay").click(function(){a(s,r,e)}),s.filter("#cable_test_ports").on("keypress",function(t){13===t.keyCode&&a(s,r,e)}),l("#cable_test_indiv_port").hide(),dashhelp("cable_test")},lt_cable_test.stop=function(t){n&&n.stop(),n=null,live_toolbox.set_tool_status(lt_cable_test,!1),t&&(t.find(".spinner").hide(),t.find(".ltplay, .ltstop").attr("class","ltplay").attr("alt","Go"))},lt_cable_test.render_pair_status=function(t,e){var s=t.curlink,r=t["st"+(e-1)];if("sfp"===s||!r)return"";if(!c(t))return"-";var n=r.match(/^\d+:(.*)$/);if(!n)return"";t="cable_test_status_unimportant",r=n[1];return s.match(/\d+[fh]dx/)&&2<e?r="-":t="ok"===n[1]?"cable_test_status_ok":"cable_test_status_fail","<span class='"+t+"'>"+r+"</span>"},lt_cable_test.render_status=function(t){var e=!1;if("1Gfdx"===t.curlink)e="0:ok"===t.st0&&"0:ok"===t.st1&&"0:ok"===t.st2&&"0:ok"===t.st3;else{if(!c(t))return"-";e="0:ok"===t.st0&&"0:ok"===t.st1}return e?"<span class='cable_test_status_ok'>OK</span>":"<span class='cable_test_status_fail'>Failure</span>"},lt_cable_test.render_length=function(t){if("sfp"===t.curlink)return"-";var e=(t.len0+t.len1+t.len2+t.len3)/4;if(0===e&&c(t))e=1;else if(0===e)return"-";return e+" m"}}(jQuery);