/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
var Cache=function(e){this.cache={},this.getFn=e};Cache.prototype.get=function(e){var n=this.cache[e];return void 0!==n?n:(this.cache[e]=this.getFn(e),this.cache[e])},Cache.prototype.reset=function(e){this.cache=_.extend({},e)};var make_change_tracker=function(){var k=[],a=window.onbeforeunload;return window.onbeforeunload=function(e){var n,t;if("function"==typeof a&&"string"==typeof(n=a(e)))return n;for(e=e||window.event,t=0;t<k.length;++t)if(k[t].count(null,!0))return n="Your changes have not been saved.",e&&(e.returnValue=n),n},$j("html").on("submit_success.configurejs","form.configure_form",function(){$j(".notice.unsaved_changes").remove()}),$j("html").on("config_error.configurejs submit_error.configurejs","form.configure_form",function(){$j("#floating_submit").attr("disabled",!1)}),function(e){var t,a,r=0,o={},c=[],i=!1;function s(){var e=$j(this).mval();void 0!==e&&a.change(this.name,e,this)}function u(){t.suppress_alert=!0}var l=["<div>You have unsaved changes.</div>",'<div id="floating_unsaved">','<span><input id="floating_submit" type="submit" value="Save" data-testid="save_button"></span>'," or ",'<span><a id="floating_cancel_changes">cancel</a></span>',"</div>"].join("\n"),f=$j("body"),h=new Cache(function(e){return $j("body").find("label[for='"+e+"']")}),d=new Cache(function(e){var n=e.substr(0,e.indexOf(" ")),e=e.substr(e.indexOf(" ")+1);return $j("body").find("select[name='"+n+"'] option[value='"+e+"']")});function g(){var e,n=0<r;t&&t.highlight&&((e=$j(t.highlight)).data("unsaved")!=n&&e.data("unsaved",n).add(".monitor_unsaved_changes").toggleClass("unsaved",n)),"usage"!==Mkiconf.controller_name&&"nodes"!==Mkiconf.controller_name&&(f=t?t.selector?$j(t.selector):$j(t.highlight):$j(".monitor_unsaved_changes .save_button_container"),!i&&0<r&&0<$j("div.save_button_container").length?($j.add_status("changes",{content:$j(l),box_class:"notice unsaved_changes"}),t.disable_submit&&$j("#floating_submit").attr("disabled",!0),$j("#floating_cancel_changes").unbind("click").click(function(){u(),void 0===t.selector?window.location.reload():f.find('input[type="reset"]').click()}),$j("#floating_submit").unbind("click").click(function(){this.disabled=!0,f.find('input[type="submit"], #save_changes').filter(":visible").click()})):$j.remove_status("changes"),0<r&&$j.remove_top_status())}function v(){var e;t&&!t.nodom&&((e=$j(t.selector||".monitor_unsaved_changes")).unbind("submit",u),e.find(".suppress_unsaved_changes_alert").unbind("click",u)),r=0,c={},o=[],g()}function p(e){e=$j(e);if(e.is("select")){var n=e.attr("name");if(e.attr("multiple"))return _.map(e.val(),function(e){e=n+" "+$j.escapeSelector(e);return d.get(e).text()}).join("\n");var t=e.attr("name")+" "+$j.escapeSelector(e.val());return d.get(t).text()}if(e.is(":radio")){t=e.attr("id");return t?h.get(t).first().text():e.siblings("label").first().text()}return e.is(":checkbox")?e.is(":checked")?"yes":"no":e.val()}function b(e){var n,t=$j(e),a="string"==typeof e?e:t.attr("id")?t.attr("id"):t.attr("name");return(n=null==(n="string"!=typeof e&&t.is(":radio")?n:h.get(a).first().text())||""==n?"string"==typeof e?e:void 0!==t.attr("change-label")?t.attr("change-label"):t.parents(".cfgo").siblings(".cfgq").only_text():n)?$j.trim(n).split(/\s\s+/)[0]:""}function m(e,n){a.track(this,n)}return(a=function(i){var e,n;v(),(t=$j.extend({opacity:.95,fadeInTime:100,fadeOutTime:500,send_with_form:!1},i||{})).nodom||((e=$j(t.selector||".monitor_unsaved_changes")).on("track",":input",t,m),e.on("change.change_tracker",":input:not(.notrack)",s).on("click.change_tracker",":checkbox:not(.notrack)",s).on("keyup.change_tracker","textarea:not(.notrack)",s),n={},e.find("label").each(function(){var e=$j(this);n[e.attr("for")]=e}),h.reset(n),i={},e.find("select").each(function(){var e,t=$(this),a=t.attr("name"),n=t.val();_.isArray(n)?_.each(n,function(e){var n=t.find("option[value='"+$j.escapeSelector(e)+"']");0<n.length&&(i[a+" "+e]=n)}):0<(e=t.find("option[value='"+$j.escapeSelector(n)+"']")).length&&(i[a+" "+n]=e)}),d.reset(i),e.find("input, select, textarea").not(".notrack").filter("[name]").each(function(){a.track(this)}),t.send_with_form&&0==e.find("#settings_change_hash").length&&e.append("<input type='hidden' id='settings_change_hash' name='settings_change_hash' />"),e.bind("submit",u),e.find(".suppress_unsaved_changes_alert").bind("click",u)),$j.inArray(a,k)<0&&k.push(a)}).pack_changes=function(){t.send_with_form&&$j("#settings_change_hash").val(JSON.stringify(a.get_changes()))},a.get_changes=function(){var t={};return _(c).each(function(e,n){_.isEqual(e[0],e[1])||(t[n]=e[2])}),t},a.dump_form_values=function(e){if(!e)return c;console.dir(c)},a.toggle=function(e){var n=$j(t.selector||".monitor_unsaved_changes");n.off(".change_tracker"),e&&n.on("change.change_tracker",":input:not(.notrack)",s).on("click.change_tracker",":checkbox:not(.notrack)",s).on("keyup.change_tracker","textarea:not(.notrack)",s)},a.track=function(e,n){if(e){var t,a;!_.isArray(n)&&_.isObject(n)&&(n=jQuery.extend(!0,{},n));var i={label:"",new_text:"",old_text:""};if("object"==typeof e&&"nodeType"in e&&e.name){if(_.contains(o,e)||o.push(e),i.label=b(e),i.old_text=i.new_text=p(e),void 0===(t=$j(e).mval()))return;void 0===n&&(n=t),a=e.name}else{if("string"!=typeof e)throw new Error("bad change_tracker.track");t=n,i.label=b(e),i.old_text=i.new_text=n,a=e}c.hasOwnProperty(a)&&!_.isEqual(c[a][0],c[a][1])&&--r,c[a]=[n,t,i],_.isEqual(n,t)||++r,g()}},a.untrack=function(e){var n;if(e){if("object"==typeof e&&"nodeType"in e&&e.name){for(n=0;n<o.length;++n)if(o[n]==e){o.splice(n,1);break}e=e.name}else if("string"!=typeof e)throw new Error("bad change_tracker.untrack");c.hasOwnProperty(e)&&a.change(e,c[e][0]),delete c[e]}},a.change=function(e,n,t){var a,i;!_.isArray(n)&&_.isObject(n)&&(n=jQuery.extend(!0,{},n)),void 0!==c[e]&&(_.isEqual(n,c[e][1])||(a=!_.isEqual(c[e][0],c[e][1]),i=!_.isEqual(c[e][0],n),a&&!i?--r:!a&&i&&++r,g()),c[e][1]=n,c[e][2].new_text=t?p(t):n)},a.changed=function(e){return void 0!==c[e]&&!_.isEqual(c[e][0],c[e][1])},a.count=function(e,n){return(!n||!t.suppress_alert)&&(e?_.filter(e,function(e){return c.hasOwnProperty(e)&&!_.isEqual(c[e][0],c[e][1])}).length:r)},a.hide_box=function(e){return void 0!==e&&(i=e),g(),i},a.reset=function(){a(t),$j(document).trigger("change_tracker_reset")},a.confirm=function(){return!(r&&!t.suppress_alert)||confirm("Are you sure you want to navigate away from this page?\n\nYour changes have not been saved.\n\nPress OK to continue, or Cancel to stay on the current page.")},a.kill=function(){var e;v(),0<=(e=$j.inArray(a,k))&&k.splice(e,1)},a.find_label_for=function(e,n){e=c[e];e&&(e[2].label=b(n))},a.disable_submit=function(){$(".save_button_container").find("input[type='submit']").attr("disabled",!0),t.disable_submit=!0},a(e),a}}(),change_tracker=make_change_tracker({nodom:1,nobox:1});