/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(o){function e(t){t=t.find(".flex-editor");return t.not(t.find(".flex-editor"))}o.short_save_button=function(t){return"<div class='cf' style='margin: 8px 0'><div class='alert alert-danger' style='display:none'></div><a class='btn btn-default save'>"+(t||"Save")+"</a><div class='alert ilb alert-clear xhr_status' style='margin-left:10px'></div></div>"},o.fn.formlet_get=function(){var n={},t=o(this),a=t.find(":input").not(":button, :submit"),t=e(t),a=a.not(t.find(":input"));return t.each(function(){var t=o(this).data();_(n).named_set(t.name,t.to_obj()),_(n).named_set(t.name+"_deleted",t.deleted)}),a.each(function(){var t=o(this),a=t.attr("name");t.is("[type=radio]:not(:checked)")||a&&(t=t.is(":checkbox")?t.is(":checked"):o(this).data("val")||o(this).val(),_(n).named_set(a,t))}),n},o.fn.formlet_set=function(n){n=n||{};var t=o(this),a=t.find(":input").not(":button, :submit"),t=e(t),a=a.not(t.find(":input"));return t.each(function(){var t=o(this).data();t.set_rows(_(n).named_get(t.name)||[])}),a.each(function(){var t=o(this),a=t.attr("name");a&&(a=_(n).named_get(a)||t.data("default")||"",t.is(":checkbox")?t.prop("checked",!!a).change():t.is(":radio")?t.prop("checked",a==t.val()):t.val(a).change())}),this},o.fn.ajaxify=function(t){var a="string"==typeof t?{url:t}:t||{},i=o(this),s=o(this).find(".btn.save");return s&&s.on("click",function(){var n,e,t;s.hasClass("disabled")||(s.addClass("disabled"),(a.on_submit||o.noop)(),n=_.extend(i.formlet_get(),a.data||{}),(a.modify_data||o.noop)(n),e=[],_.each(a.validate||{},function(t,a){t.fn(n[a],n)||e.push(t.msg)}),0<e.length?(alert(e.join("\n\n")),s&&s.removeClass("disabled")):(t=a.dataType?o.post(a.url,n,null,a.dataType):o.post(a.url,n),i.xhr_status(t,a.status_opts),t.done(a.done||o.noop),t.fail(a.fail||o.noop),t.always(function(){s&&s.removeClass("disabled"),(a.always||o.noop)()})))}),this},_.mixin({named_get:function(t,a){var n=t,a=_.compact(a.split(/[\[\]]+/));return _.each(a,function(t){void 0!==n&&(n=n[t])}),n},named_set:function(t,a,n){var e=t,a=_.compact(a.split(/[\[\]]+/));_.chain(a).initial().each(function(t){void 0===e[t]&&(e[t]={}),e=e[t]}),e[_(a).last()]=n}})}(jQuery);