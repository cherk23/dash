/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(o){window.password_strength={};var t,e=o("#meter"),n=o("#meter_img");0<e.length&&(t=o("<div id='pwContain' name='pwBar'></div><span id='pwNote'></span>").appendTo(e),window.spin&&o("<span id='pwSpinner'>"+spin+"</span>").appendTo(t),window.miles&&o("<div id='pwConf'>"+miles+"</div>").appendTo(n));var a=o("[name=pwBar]"),d=o("#pwNote"),s=o("#myinput"),r=o("#confirm"),p=o("#pwConf"),w=o("#pwSpinner");o("#old_password");0<e.length&&((s=o("#user_password")).bind("keyup",function(){password_strength.updateStrength(!1),password_strength.updateWeak()}),s=o("#user_password"),(r=o("#user_password_confirmation")).bind("keyup",function(){password_strength.updateWeak()}),r=o("#user_password_confirmation")),password_strength.updateStrength=function(t){var n=t,e=(p.find("img"),a.width()),s=(t=password_strength.getStrength())[0],r=t[1],t=t[2];s<0?(a.attr("id","pwContain"),a.css("background-color","white"),password_strength.resetNote(),o("#pwContain").setBar({width:0})):0==s&&1!=e?(a.attr("id","pwContain"),a.css("background-color","white"),o("#pwContain").setBar({width:1}),password_strength.resetNote(),d.text(`Must be at least ${Mkiconf.min_password_length} characters long`)):1==s&&15!=e?(a.attr("id","pwContainer"),a.css("background-color","red"),o("#pwContainer").setBar({width:15}),n?password_strength.displayNote(r,t):d.text("Weak")):2==s&&30!=e?(a.attr("id","pwContainer"),a.css("backgroundColor","red"),o("#pwContainer").setBar({width:30}),n?password_strength.displayNote(r,t):(password_strength.resetNote(),d.text("Weak"))):3==s&&45!=e?(a.attr("id","pwContainer"),a.css("background-color","orange"),o("#pwContainer").setBar({width:45}),n?password_strength.displayNote(r,t):(password_strength.resetNote(),d.text("Medium"))):4<=s&&(password_strength.resetNote(),Mkiconf.no_common_word?d.text("Strong"):(w.css("display","inline"),d.text("Verifying strength..."),password_strength.common_word(n)))},password_strength.updateWeak=function(){var t=p.find("img");!(s.val().length<Mkiconf.min_password_length)&&s.val()==r.val()?t.show():t.hide()},o.fn.setBar=function(){var t=o(this[0]),n=arguments[0]||{};t.animate({width:parseInt(t.css("width"),10)==n.width?-t.width:n.width},{complete:function(){n.strong?password_strength.checkConf():n.strong||password_strength.updateWeak()}})},password_strength.getStrength=function(){var t=-1,n=new Array,e=0;return 0<s.val().length&&(t++,s.val().length>=Mkiconf.min_password_length&&(t++,s.val().match(/[a-z]/)?t++:(n.push("lowercase letter, "),e++),s.val().match(/[A-Z]/)?t++:(n.push("uppercase letter, "),e++),s.val().match(/\d+/)?t++:(n.push("number, "),e++),s.val().match(/[\W_]/)?t++:(n.push("symbol, "),e++))),[t,n,e]},password_strength.resetNote=function(){d.text("")},password_strength.displayNote=function(t,n){var e="";for(i=0;i<n;i++)e+=t[i]+"or ";e=e.substr(0,e.length-5),1<n&&(password_strength.resetNote(),d.text("Add "+e))},password_strength.checkConf=function(){var t=p.find("img");75==o("#pwContainer").width()&&r.val()==s.val()?t.show():t.hide()},password_strength.common_word=function(t){var n=t,t="pw="+encodeURIComponent(s.val());0===e.length?o.ajax({type:"POST",url:Mkiconf.manage_base+"/dashboard/common_word",data:t,dataType:"json",success:function(t){w.hide(),s.val()==t.pw&&(t.common?(a.attr("id","pwContainer"),a.css("background-color","#FFCC00"),o("#pwContainer").setBar({width:60}),password_strength.resetNote(),n?d.text("Must not contain any common words or names"):d.text("Medium (contains common word or name)")):(a.attr("id","pwContainer"),a.css("background-color","#66CC00"),o("#pwContainer").setBar({width:75,strong:n}),password_strength.resetNote(),d.text("Strong")))}}):o.ajax({type:"POST",url:account_base,data:t,dataType:"json",success:function(t){w.hide(),s.val()==t.pw&&(t.common?(a.attr("id","pwContainer"),a.css("background-color","#FFCC00"),o("#pwContainer").setBar({width:60}),password_strength.resetNote(),d.text("Medium (contains common word or name)")):(a.attr("id","pwContainer"),a.css("background-color","#66CC00"),o("#pwContainer").setBar({width:75,strong:n}),password_strength.resetNote(),d.text("Strong")))}})},password_strength.toggle_pw=function(t){t?o("#submit_pw").attr("disabled",!1):o("#submit_pw").attr("disabled","disabled")}}(jQuery);