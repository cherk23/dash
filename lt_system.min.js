/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(o){var s,l,n,m,a;function e(){var t=o("#system_tool_select").val();o(".system_hideable_opt").hide(),"df"==t?o(".df_opt").show():"du"==t?o(".du_opt").show():"lsusb"==t&&o("#system_firmware_warning").show();t=Mkiconf.feature_versions[t];t?o("#system_firmware_warning_version").text("builds before "+t+"."):o("#system_firmware_warning_version").text("old firmware.")}function i(){lt_system.stop(),live_toolbox.set_tool_status(lt_system,!0),o("#system_textarea").text(""),o("#system_popout_button").show();var t=o("#system_tool_select").val(),e="top"==t?"Top":"CommandFetch";"top"==(l=t)&&(o("#system_stop").show(),o("#system_run").hide()),a={broker:e,command:t,filter:o("#system_filter").val()},"df"==l?_.each(["#system_k","#system_m","#system_h"],function(t){o(t)[0].checked&&(a[o(t).val()]=!0)}):"du"==l&&(a.file=o("#system_file").val(),_.each(["#system_total","#system_summarize","#system_human-readable"],function(t){o(t)[0].checked&&(a[o(t).val()]=!0)})),s=o.comet.command_subscribe(a,p)}function p(t){m=new Date,e=m,s=unparse_date(e,"%b %-d %H:%M:%S %Z"),e="top"==l?"Updated at ":"Completed at ",o("#system_last_fetched").text(e+s);var e=o("#system_textarea");"top"==l&&e.text("");var s=t.data.chunk;s&&0<s.length&&e.text(e.text()+s),t.data.completed&&lt_system.stop()}function c(){var t=o("#lt_system_popout").clone(),e=o("link[href*='manage.css?mtime'").clone();t.prepend(e),t.find("#system_popout_tool").html(a.command),t.find("#system_popout_last_seen").html(unparse_date(m,"%b %-d %H:%M:%S %Z")),t.find("#system_popout_filter").html(a.filter),t.find("#system_popout_contents").html(o("#system_contents").html());e=t.find("#system_textarea");e.attr("id","system_popout_textarea"),e.height("calc(100% - 37px)").width("calc(100% - 5px)"),(n=window.open("","_blank","height=600,width=1000,status=yes,toolbar=no,menubar=no,location=no")).document.write(t.html()),n.document.title=a.command+"_"+m}window.lt_system={},lt_system.init=function(t){o("#lt_system_tmpl").tmpl().appendTo(t),o("#system_run").click(i),o("#system_stop").click(lt_system.stop),o("#system_stop").hide(),o("#lt_system_popout").hide(),o("#system_popout_button").hide(),o("#system_popout_button").click(c);t=["top","dmesg","ps","df","du"];Mkiconf&&Mkiconf.has_wired&&t.push("lsusb"),o.each(t,function(t,e){o("#system_tool_select").append(o("<option />",{value:e.split(" ")[0],text:e}))}),o("#system_tool_select").chosen({placeholder_text:"Select tool"}),o.get(url_for({controller:"nodes",action:"router_files_for_fetch"})).done(function(t){o("#system_file").focus(function(){o(this).typeahead({source:JSON.parse(t)})})}),e(),o("#system_tool_select").change(e),dashhelp("system_help","#lt_system_header",{above:!0}),dashhelp("live_tool_filter_help","#system_filter_span")},lt_system.stop=function(){s&&s.stop(),s=null,o("#system_stop").hide(),o("#system_run").show(),live_toolbox.set_tool_status(lt_system,!1)}}(jQuery);