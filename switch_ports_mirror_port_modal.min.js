/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
!function(p){var u,m,h,t,o,w,s,f,a=["existing_source_ports","source_ports_to_add","source_ports_to_remove","destination_node_id","destination_port_num"],v=0,b=1,k=2,g=3,y=4;function x(r,t){return _.isNull(t.stack_id)?(i=t,_.any(r,function(r){return r.switch_id==i.switch_id&&(r.is_mirror_src_port||r.is_mirror_dest_port)})):(o=t,_.any(r,function(r){return r.stack_id==o.stack_id&&(r.is_mirror_src_port||r.is_mirror_dest_port)}));var o,i}function C(t,r,o){var i;_.isNull(o.stack_id)?(t.append(p("<option></option>").attr("value",o.switch_id||o.node_profile_id).text(o.switch)),t.attr("disabled","disabled")):_.each((i=f,_.uniq(e(i,o),function(r){return r.switch_id})),function(r){t.append(p("<option></option>").attr("value",r.switch_id).text(r.switch))})}function N(r,t,o){r.append(p("<option></option>").attr("value",o.switch_id||o.node_profile_id).text(o.switch)),r.attr("disabled","disabled"),t.val(o.num[0]),t.attr("disabled","disabled")}function S(t,r){_.each(r,function(r){t.append(p("<li></li>").attr("val",r.id).text(r.switch+"/"+render_port_number(r)))})}function j(r){return _.find(i(f,r),function(r){return r.is_mirror_dest_port})}function D(r){return _.filter(i(f,r),function(r){return r.is_mirror_src_port})}function i(r,t){return _.isNull(t.stack_id)?(o=t,_.filter(r,function(r){return r.switch_id==o.switch_id})):e(r,t);var o}function e(r,t){return _.filter(r,function(r){return r.stack_id==t.stack_id})}function n(){p("#switch_ports_mirror_port_notice").hide();var r=p("#switch_ports_mirror_existing_source_ports"),t=r.parents("tr");t.show(),r.empty();var o=p("#switch_ports_mirror_source_ports_to_add"),i=o.parents("tr");i.show(),o.empty();var e=p("#switch_ports_mirror_source_ports_to_remove"),s=e.parents("tr");s.show(),e.empty();var a=p("#switch_ports_mirror_destination_node_id");a.empty(),a.removeAttr("disabled");var n,d=p("#switch_ports_mirror_destination_port_num");d.val(""),d.removeAttr("disabled");var c=u[0],l=p("#switch_ports_mirror_port_modal_submit_button");switch(h=m&&!x(f,c)?v:m&&x(f,c)?b:!m&&_.all(u,function(r){return r.is_mirror_src_port})?k:!m&&1==_.size(u)&&u[0].is_mirror_dest_port?g:y){case v:n="Create port mirror",t.hide(),i.show(),S(o,u),s.hide(),C(a,0,c);break;case b:n="Update port mirror",t.show(),S(r,D(c)),i.show(),S(o,u),s.hide(),N(a,d,j(c));break;case k:n="Update port mirror",t.show(),S(r,D(c)),i.hide(),s.show(),S(e,u),N(a,d,j(c));break;case g:n="Delete port mirror",t.show(),S(r,D(c)),i.hide(),s.hide(),N(a,d,c);break;default:n="Error"}w.find("#title_bar").text(n),l.text(n)}function d(r){var t,o=p(this),i={};if(r.preventDefault(),"disabled"!==o.attr("disabled")){switch(_.each(a,function(r){var t="#switch_ports_mirror_"+r;p(t).is("ul")?i[r]=_.map(p(t+" li"),function(r){return p(r).attr("val")}):i[r]=p(t).val()}),h){case v:t="create_port_mirror";break;case b:case k:t="update_port_mirror";break;case g:t="delete_port_mirror";break;default:return}p("#switch_ports_mirror_port_notice").removeClass("label-danger").addClass("label-default").show().html("Saving..."),o.attr("disabled","disabled"),p.ajax({type:"POST",dataType:"json",url:url_for({controller:"configure",action:t}),data:i,success:function(r){!r||r.error?e(r&&r.error):(s(r),window.page_saving_status=0,p.top_status({content:m?"Created mirror":"Deleted mirror",remove_after:4e3,box_class:"good"}),w.modal("hide")),o.attr("disabled",!1)},error:function(r){var t;try{t=JSON.parse(r.responseText).error}catch(r){}e(t),o.attr("disabled",!1)}})}function e(r){window.page_saving_status=2,p("#switch_ports_mirror_port_notice").removeClass("label-default").addClass("label-danger").html(r||"Error saving changes").show()}}window.switch_ports_mirror_port_modal={},switch_ports_mirror_port_modal.init=function(r){(w=p(r).modal({keyboard:!0,backdrop:!0,show:!1}).on("shown.bs.modal",n).on("hide.bs.modal",function(){t=window.scrollX,o=window.scrollY}).on("hidden.bs.modal",function(){urlHash.removeState("edit"),void 0!==t&&void 0!==o&&window.scroll(t,o)})).find(".btn-primary").on("click",d)},switch_ports_mirror_port_modal.show=function(r,t,o,i){r&&r!=={}?(u=r,m=i,s=o,f=t,w.modal("show")):log_error("switch_ports_mirror_port_modal:Invalid params")}}(jQuery);