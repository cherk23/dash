/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
window.ftAddon=window.ftAddon||{},window.ftAddon.add_col=function(l,u){function n(t,n){var e=this,o=t.container,r=l(window),c=n&&n.container;c&&(o=l(n.container)),e.flex_table=t,e.dropdown=i.clone();var d,n=(t.unselectable_columns||[]).concat(t.initial_fields||[]);e.columns=u.map(u.omit(t.columns,n),function(n,t){return n._key=t,n}),e.columns=u.filter(e.columns,function(n){return!(!1===n.selectable||!u.isString(n.l))}).sort(function(n,t){return n.l.toLowerCase().localeCompare(t.l.toLowerCase())}),e.generate_dropdown.apply(e),u.each(t.selected_fields(),function(n){e.dropdown.find('input[data-key="'+n+'"]').prop("checked",!0)}),o.append(e.dropdown),t.container.on("columns_changed",function(n){e.dropdown.find(":checked").prop("checked",!1),e.dropdown.find(u.map(t.selected_fields(),function(n){return'input[data-key="'+n+'"]'}).join(",")).prop("checked",!0)}),e.dropdown.on("change",'input[type="checkbox"]',function(n){n=l(n.target);n.is(":checked")?t.add_column(n.data("key")):t.remove_column(n.data("key")),r.trigger("resize")}),c||(d=o.find("th:last"),a(e.dropdown,o,d),o.on("table_rendered columns_changed",function(){d=o.find("th:last")}),r.on("resize scroll",function(){a(e.dropdown,o,d)}),o.addClass("add_col"))}var h=20,p=8,i=l("<div class='ft_add_col btn-group'><div class='btn' data-toggle='dropdown'>+</div><div class='dropdown-widget pull-right'><h2 class='details_heading'>Select columns</h2><h4 class='drag_heading'>Check to add, drag  columns to reorder.</h4><div class='checkboxes'></div></div>");function a(n,t,e){var o=l(window).width(),r=(l(document).scrollLeft(),null);try{r=t[0].getBoundingClientRect()}catch(n){r={top:t[0].offsetTop,left:t[0].offsetLeft}}0!==e.length&&(e=e[0].getBoundingClientRect(),n.css({right:e.right<o?r.right-e.right:r.right-o,height:e.bottom-e.top}))}return n.prototype={generate_dropdown:function(){var n,e,t=this,n=(t.flex_table,n=t.columns,e={},u.each(n,function(n){var t=n.group||"Misc";e[t]?e[t].push(n):e[t]=[n]}),n=function(t,n){var e,o=[],r=[],c=Math.ceil(n.length/h),d=t;1<u.keys(t).length&&n.length<=h&&n.length>p&&(c=2);for(var l=0;l<c;l++){var i=[],a=[],s=[];u.each(d,function(n,t){a.push(t),s.push(n.length)}),e=function(n,t){var e,o=[[]],r=[[]],c=t.length,d=n,l=n,i=[];for(;0<=d;)o[0].push(0),r[0].push(0),--d;d=c;for(;d;)o.push([]),r.push([]),--d;for(d=1;d<=c;d++)for(e=0;e<=n;e++)t[d-1]<=e&&t[d-1]+o[d-1][e-t[d-1]]>o[d-1][e]?(o[d].push(t[d-1]+o[d-1][e-t[d-1]]),r[d].push(1)):(o[d].push(o[d-1][e]),r[d].push(0));d=c;for(;d;)1==r[d][l]&&(i.push(d-1),l-=t[d-1]),--d;return{to_take:i,total_size:o[c][n]}}(Math.floor(n.length/c),s),i=u.map(e.to_take,function(n){return a[n]}),o.push(i),d=u.omit(d,i)}!u.isEmpty(d)&&0<o.length&&(o[o.length-1]=o[o.length-1].concat(u.keys(d)));o=u.sortBy(o,function(n){n=u.sum(u.map(n,function(n){return-1*(t[n].length+2)}));return r.push(-1*n),n}),r=r.sort(),2==o.length&&r[0]<r[1]/2&&(o=[o[0].concat(o[1])]);return o}(e,n),0<(n=u.map(n,function(n){return u.map(n,function(n){return function(n,t){t=u.map(t,function(n){return"<li><label><input type='checkbox' data-key='"+n._key+"'>"+n.l+"</label></li>"});return"<div><h3 class='group_name'>"+n+"</h3><ul>"+t.join("")+"</ul></div>"}(n,e[n])}).join("")}))[0].length?"<table class='double-column'><tr><td class='left'>"+n.join("</td><td class='right'>")+"</td></tr></table>":"<div class='single-column'>"+n[1]+"</div>");t.dropdown.find(".checkboxes").html(n),1===(t=t.dropdown.find(".checkboxes .group_name")).length&&t.remove()}},n}(jQuery,_);