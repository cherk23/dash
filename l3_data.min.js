/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
function data3_now(){return window.flex_table_now||(new Date).getTime()/1e3}function node3_update_upseries(t,e,n){var a,s,i=t.upseries,l=t["last_active#"]||0,o=!1,u=0,r=e-86400,c=0,f=Math.max(r,t["created_at#"]||0);if(n=n||{},i)for(0<(a=timeseries_upper_bound(i,r))&&(u=i[a-1][1],o=o||1<u);a<i.length;++a)i[a][0]>r&&(u||(c+=i[a][0]-r),r=i[a][0]),i[a][0]>f&&(u||i[a][0],f=i[a][0]),u&&(l=i[a][0]),u=i[a][1],o=o||1<u;u?l=e:c+=e-r,c!=t["outage_graph#"]&&(t["outage_graph#"]=c,n["outage_graph#"]=1),t["last_active#"]||(t["last_active#"]=0),l>EPOCH_WARNING_TS&&(l/=1e3),l&&l>t["last_active#"]&&(t["last_active#"]=l,n["last_active#"]=1),s=t["status#"],e=t.alerting,o||1!=s||0!=t["status#"]||(t["status#"]=0),t["status#"]!=s&&(n["status#"]=1),t.alerting!=e&&(alert_count+=e?-1:1,n.alerting=1),e=4==u||5==u||8==u,!t.iswd&&o&&u&&e!=t.is_gateway&&(t.is_gateway=e,n.is_gateway=1)}data3_load=function(G){var I,J,f=[],d=!1;function m(){var t,e;for(t in window.Mkijson=J=window.Mkijson||{},window.extra_nodes_hash=window.extra_nodes_hash||{},{n:1,c:1,g:1,ng:1})J[t]=J[t]||{};for(t in{hash:1,meta:1,all:1,allmeta:1})e="nodes_"+t,J.n[t]=window[e]=window[e]||J.n[t]||{},e="clients_"+t,J.c[t]=window[e]=window[e]||J.c[t]||{},J.g[t]=J.g[t]||{},J.ng[t]=J.ng[t]||{};for(t in J)J[t].type=t,J[t].all&&(J[t].all.count=J[t].all.count||0);/^[cu]$/.test(Mkiconf.h3mode)?J.main=J.c:"g"==Mkiconf.h3mode?J.main=J.g:"ng"==Mkiconf.h3mode?J.main=J.ng:J.main=J.n,d=!0}function o(t,e,n){return"if ((b=n."+t+")) {for (r=s=t=0, i=b.length-1; i>=0; --i) {x=b[i];if (x.length>1)r+=x[1]||0, s+=x[2]||0"+(e?", t=t||x[0]":"")+";}"+n+"}"}function R(t,e,n,a){var s,i,l="";return"n"!=t||!n.nuseblocks||a.backfill||n["usage#"]||(l+=o("nuseblocks",!1,"if (r+s) n['usage#'] = (r+s)*1024;"),n["usage#"]=n.nuseblocks),"n"==t&&n.nuseblocks&&a.ids&&(l+="n.nuseblocks=n.nuseblocks||[];"),"c"==t&&n["last_seen_by#"]&&!n.node_id&&(l+="n.node_id=n['last_seen_by#'];"),"c"!=t||!n.cuseblocks||a.backfill||n.usage&&n["last_seen_at#"]||(s="",i=!1,n.usage||(s+="if (r+s) n.usage = [r,s];",n.usage=n.cuseblocks),n["last_seen_at#"]||(s+="if (t) n['last_seen_at#'] = t;",n["last_seen_at#"]=n.cuseblocks,i=!0),l+=o("cuseblocks",i,s)),"c"==t&&n.cuseblocks&&a.ids&&(l+="n.cuseblocks=n.cuseblocks||[];"),"c"!=t||!n.susage||n.cuseblocks||a.backfill||n.usage||(l+="if ((b=n.susage)) { for(x=[0,0],i=b.length-1;i>=0;--i) x[i&1]+=b[i]; if(x[0]+x[1]) n.usage=x; }",n.usage=n.susage),"c"==t&&n.ass_at_weak&&e.allclient&&"number"==typeof e.allclient.ass_at_cutoff&&(l+="if (n.ass_at==null&&n.ass_at_weak==null) { n.ass_at_weak="+e.allclient.ass_at_cutoff+"; }"),""==l?null:build_func("function(n){var i,b,x,r,s,t;"+l+"}",{})}function W(a,s){return 0==arguments.length?function(t,e,n){t[n]=e[n],delete t[n+"_missing"]}:function(t,e,n){t[n]=e[n],t[n+"_missing"]=[a,s]}}function X(t,e,n,a){var s,i,l,o;if(a[e]==n)return 1;if(i=t[s=e+"_missing"])for(o=a.t1,l=i.length-2;0<=l;l-=2)if(i[l]==n&&i[l+1]==o)return 2==i.length?delete t[s]:i.splice(l,2),1}function Y(t,a,s){var i=t.t1,e=a.t1;return t.incr?s:a.t0&&t.t0!=a.t0||e&&!(e<=i)?a.t0&&t.t0!=a.t0?function(t,e,n){t[n]&&!X(t,n,i,a)||s(t,e,n)}:W(i,e):W()}function n(t,e,o,n){var a,s,i,l,u,r,c,f,d,m,g,_,b,p,h,k=t.t0,w=t.t1,j={},v=[],x={n:"node",c:"client",g:"login",ng:"node_group"}[e],y=t[x+"s"],M=t.incr,T=I[e],$=J[e],D=$.hash,A=$.meta;if(n&&!0!==n||(n={}),r=t["meta"+x]||{},(d=t["all"+x])&&(c=t["metaall"+x]),y&&(!M||k&&w&&!t.partial)){if(M&&k!=A.t1)for(a in r)if(A[a]&&"id"!==a&&A[a]!=k&&o[a])return;if(!M&&k&&A.t0){for(a in r)A[a]&&"id"!==a&&(n.backfill=!0);(r.nuseblocks&&A["usage#"]||c&&c.nuseblocks&&A["usage#"]||r.cuseblocks&&A.usage)&&(n.backfill=!0)}var E,O,z,H,N,P,Q=Y(t,A,blocked_property_add),S=Y(t,A,mapped_blocked_property_add);if(E=A,O=($=t).t1,x=E.t1,g=$.incr?timed_property_splice:E.t0&&$.t0!=E.t0||x&&!(x<=O)?E.t0&&$.t0!=E.t0?function(t,e,n,a,s){X(t,n,O,E)&&timed_property_splice(t,e,n,a,s)}:W(O,x):W(),z=A,H=($=t).t1,x=z.t1,_=$.incr||!z.t0&&!x?null:z.t0&&$.t0!=z.t0||x&&!(x<=H)?z.t0&&$.t0!=z.t0?function(t,e,n){X(t,n,H,z)&&(t[n]=(t[n]||0)+e[n])}:W(H,x):W(),N=A,P=($=t).t1,x=N.t1,b=$.incr||!N.t0&&!x?vector_property_add:N.t0&&$.t0!=N.t0||x&&!(x<=P)?N.t0&&$.t0!=N.t0?function(t,e,n){X(t,n,P,N)&&vector_property_add(t,e,n)}:W(P,x):W(),m=R(e,t,r,n),n.ids){if("string"==typeof(l=n.ids))l=l.split(/\s+/);else if(!Array.isArray(l))for(s in l=[],n.ids)l.push(s);for(s=l.length-1;0<=s;--s)""===(i=l[s])||y[i]||(y[i]={})}for(i in y)l=y[i],m&&m(l),(u=D[i])?C(u,l,!1,j):M?v.push(i):n.backfill?n.add_or_replace&&(u=D[i]||{id:i},C(D[i]=u,l,!0,j)):C(u=D[i]={id:i},l,!0,j);if(v.length&&Z.adder&&Z.adder(e,v),t.partial&&A.t0||n.backfill||G.isEmptyObject(r)&&G.isEmptyObject(y)){if(!t.partial)for(a in r)A[a]&&k!=A[a]||(A[a]=r[a])}else{for(a in r)A[a]=r[a];k&&(!A.t0||k<A.t0)&&(A.t0=k),w&&(!A.t1||w>A.t1)?A.t1=w:t.at&&!A.t1&&(A.t1=t.at),t.at&&(A.at=t.at)}if(A.t0=A.t0||k,A.t1=A.t1||w,w&&(A.timeoffset=A.timeoffset||{},A.timeoffset[w]=Math.round((new Date).getTime()/1e3-(t.at||w))),d&&(!t.partial||n.ids)){for(a in(m=R(e,t,c,n))&&m(d),p=(a=Z.aggobject(e,n.ids,!0,k)).data,h=a.meta,C(p,d,!1,{}),c)h[a]=c[a];for(a in w&&(!h.t1||w>h.t1)&&(h.t1=w),c)if(r[a]&&o[a])throw new Error("XJ")}if(r.upseries&&!r["last_active#"]&&(A["last_active#"]=r.upseries),r.upseries)for(i in D)node3_update_upseries(u=D[i],w,j);else if((r["config_new_at#"]||r["config_fetch_at#"]||r["eapol_test_failed_at#"])&&A.upseries)for(i in y)node3_update_upseries(u=D[i],A.t1,j);if(!n.backfill){for(s in f=d="",p=(a=Z.aggobject(e,null,!0,A.t0)).data,h=a.meta,t.at&&(h.at=t.at),w&&(!h.t1||w>h.t1)&&(h.t1=w),r.cuseblocks&&(a=Mkijson.n)&&a.allmeta.nuseblocks&&a.allmeta.nuseblocks==k&&(d+=",nallobj=Mkijson.n.all",a.allmeta.nuseblocks=r.cuseblocks,r.cuseblocks_fullt1&&(a.allmeta.nuseblocks_fullt1=r.cuseblocks_fullt1),f+="if ((x=n.cuseblocks)) blockseries_add(nallobj.nuseblocks, x);"),{nuseblocks:1,cuseblocks:1})r[s]&&(p[s]=p[s]||[],h[s]=r[s],f+="if ((x=n['"+s+"'])) blockseries_add(allobj['"+s+"'], x);");for(s in{usage:1,susage:1})r[s]&&(p[s]=p[s]||[],h[s]=r[s],f+="if ((x=n['"+s+"'])) vector_add(allobj['"+s+"'], x);");for(s in r.rusage&&(Mkijson.n.all.rusage=Mkijson.c.all.rusage=Mkijson.n.all.rusage||{},Mkijson.n.allmeta.rusage=Mkijson.c.allmeta.rusage=r.rusage,f+="if ((x=n['rusage'])) rusage_sum(allobj.rusage, x);"),{"usage#":1,downtime:1,uptime:1})r[s]&&(p[s]=p[s]||0,h[s]=r[s],f+="allobj['"+s+"'] += n['"+s+"']||0;");""!=f&&build_func("function (jhash, allobj) {var x,id,n"+d+";for (id in jhash) {n = jhash[id];"+f+"}}",{})(y,p),p.usage&&(p.tusage=vector_sum(p.usage))}t.products&&(Mkiconf.products=Mkiconf.products||{},G.extend(Mkiconf.products,t.products)),G(document).trigger("node_change",[j])}function C(t,e,n,a){var s,i,l=n;for(s in e)i=o[s],void 0===t[s]?t[s]=e[s]:i?"f"==i?t[s]!==e[s]&&(t[s]=e[s],a[s]=l=!0):"s"==i?g(t,e,s,k,w):"b"==i?!t[s]&&M||Q(t,e,s):"v"==i?b(t,e,s):"+"==i?(_?_(t,e,s):t[s]=(t[s]||0)+e[s],e[s]&&(a[s]=!0)):">"==i?(!t[s]||e[s]>t[s])&&(t[s]=e[s],a[s]=!0):"mb"==i&&(!t[s]&&M||S(t,e,s)):t[s]!==e[s]&&(t[s]=e[s],a[s]=!0);l&&T(t,n)}}function Z(t,e){d||m(),t.nodes&&n(t,"n",{upseries:"s",bootseries:"s",nuseblocks:"b",nsuseblocks:"mb","usage#":"+",mac:"f",name:"f",downtime:"+",uptime:"+"},e),t.clients&&n(t,"c",{cuseblocks:"b",usage:"v",susage:"v",tusage:"+","last_seen_at#":">",description:"f",mdns_name:"f",netbios:"f",dhcp_hostname:"f",mac:"f"},e),t.logins&&n(t,"g",{token:"f",mac:"f"},e),t.node_groups&&n(t,"ng",{},e)}function g(t){var e,n,a;if(!t)return"";if("string"==typeof t)t=t.split(/\s+/);else if(Array.isArray(t))t=[].concat(t);else{for(e in n=[],t)n.push(e);t=n}for(t.sort(strcmp),e=a=0;e<t.length;++e)!t[e]||0<e-a&&t[e-a-1]==t[e]?++a:t[e-a]=t[e];return t.length=t.length-a,t.join(" ")}function u(t,e){var n;for(t.timedall=t.timedall||[],n=0;n<t.timedall.length&&t.timedall[n].meta.t0!=e;++n);return n==t.timedall.length&&t.timedall.push({ids:null,data:{},meta:{t0:e}}),t.timedall[n]}return I={n:function(t,e){t.uname&&null==t.name&&(t.name=t.uname),null!=t.name&&""!=t.name&&t.name!=t.mac||(t.name=""),""==t.name?t.name$="~"+t.mac:t.name$=human_sortable_string(t.name),e&&++J.n.all.count},c:function(t,e){var n=nodes_hash[t.node_id||0];t.last_seen_by=(n?n.name||n.mac:null)||"(unknown)",t.description$=human_sortable_string(t.description||t.mdns_name||t.netbios||t.dhcp_hostname||(t.mac?"~"+t.mac:"~~")),t.usage=t.usage||[0,0],e&&++J.c.all.count},g:function(t,e){t.token$=human_sortable_string(t.token),e&&++J.g.all.count},ng:function(t,e){e&&++J.ng.all.count}},Z.ajax=function(t,e,n,a,s){var i,l,o,u,r,c;if(d||m(),n&&"function"!=typeof n&&(n=(a=n).success),a=G.extend({},a||{}),"n"==t)a.url=Mkiconf.node_json_url;else if("c"==t)a.url=Mkiconf.client_json_url;else if("g"==t)a.url=Mkiconf.login_json_url;else{if("ng"!=t)throw new Error("x");a.url=Mkiconf.ng_json_url}for("n"==t&&Mkiconf.pinstatus?a.data=G.extend({pinstatus:1},e):a.data=G.extend({},e),null!=a.data.ssid&&a.url.match(/&ssid/)&&(a.url=a.url.replace(/&ssid=[-\d]+/,"")),a.data.ids&&(a.data.ids=g(a.data.ids)),null==a.data.huge&&1e3<(J[t].allsize||0)&&(a.data.huge=!0),a.dataType=a.jsonp="jsonp",a.success=function(t){Z(t,e),n&&n(t,e)},a.data.ids&&900<a.data.ids.length&&(a.type="POST"),u=t+":"+stable_json_stringify(a.data),i=f.length-1;0<=i;--i)if((l=f[i]).s==u){if(o=(new Date).getTime(),l.timeout){if(l.timeout>o)return setTimeout(function(t){return t=t||function(){},function(){t(null,"notexecuted")}}(a.complete),o-l.timeout),!1;break}return!1}return i<0&&f.push({s:u}),a.complete=(r=u,c=a.complete,function(t,e){var n,a;for(1==f.length&&jQuery(document).trigger("ft_data_updated"),n=f.length-1;0<=n;--n)(a=f[n]).s==r&&("success"===e||"notmodified"===e?f.splice(n,1):(a.backoff=Math.min(2*(a.backoff||.5),64),a.timeout=(new Date).getTime()+1e3*a.backoff));c&&c.apply(!0,arguments)}),a.container?G(a.container).ajaxui(a):G.ajax(a).fail(s)},Z.aggobject=function(t,e,n,a){var s,t=J[t],i=t.aggs=t.aggs||[],l=(new Date).getTime()/1e3;if(!(e=g(e))&&a)return function(t,e){var n,a;if(t.meta.t0&&t.allmeta.t0&&t.meta.t0!=t.allmeta.t0){for(n in(a=u(t,t.allmeta.t0)).data=G.extend({},t.all),a.meta=G.extend({t0:e},t.allmeta),a=t.all)delete a[n];for(n in a=t.allmeta)delete a[n]}return a=u(t,e),t.allmeta.t0||t.meta.t0&&t.meta.t0!=e||(G.extend(t.all,a.data),G.extend(t.allmeta,a.meta),a.data=t.all,a.meta=t.allmeta),a}(t,a);if(!e)return{ids:null,data:t.all,meta:t.allmeta};for(s=i.length-1;0<=s;--s)if(i[s].ids==e)return i[s].lru=l,i[s];return n?(8<=i.length&&(i.sort(function(t,e){return t.lru-e.lru}),i.shift()),i.push({ids:e,data:{},meta:{},lru:l}),i[i.length-1]):null},Z.timespan_aggobject=function(t,e,n){for(var a,s,i=J[t].timedall||[],l=0;l<i.length;++l)if((s=(a=i[l]).meta).t0&&s.t1&&s.t1-s.t0>=e&&(!n||s[n]||a.data[n]))return a;return null},Z.timeoffset=function(t,e){e=Mkijson[e||"main"].meta;if(e[t])return e.timeoffset||(e.timeoffset={}),null==e.timeoffset[e[t]]&&(e.timeoffset[e[t]]=Math.round((new Date).getTime()/1e3-e[t])),e.timeoffset[e[t]]},Z.showtimes=function(){d||m();var t=Mkijson.main.meta,e="%b %-d% #Y %H:%M% Z";G("#w3times .t0").html(unparse_date(t.t0,e,1)),G("#w3times .t1").html(unparse_date(t.grapht1||t.t1,e,1))},Z.canonicalize=function(t){function e(t,e,n,a){var s,i,l=R(a,t,n||{},{}),o=I[a];for(s in e)(i=e[s]).id=s,l&&l(i),o(i,!1)}d||m(),t.nodes&&e(t,t.nodes,t.metanode,"n"),t.clients&&e(t,t.clients,t.metaclient,"c")},Z.clean_ids=g,Z.mark_unready=function(t,e,n){t=t.unready=t.unready||{},e=t[e]=t[e]||{};(e.f=e.f||[]).push(n)},Z.sum_useblocks=function(t){var s=t[0][0][0],i={};$j.each(t,function(t,a){$j.each(a,function(t,e){var n=e[0];n<s&&(s=n),e.length<3||(i[n]=i[n]||[n,0,0],i[n][1]+=a[t][1],i[n][2]+=a[t][2])})});var n=[];return $j.each(i,function(t,e){n.push(e)}),n.sort(function(t,e){return t[0]-e[0]}),n.unshift([s]),n},Z}(window.jQuery);