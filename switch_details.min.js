/* Some or all contents Copyright (c) 2010-2025 Cisco Systems, Inc., all rights reserved */
switch_details=function(w){var b,g,k,v,x,e={uplink_port:void 0},y=!0;return e.make_switch_ports_flex_table=function(t){var s=["port_num","status","tx_bytes","tx_pkts","tx_bcast_pkts","tx_mcast_pkts","rx_bytes","rx_pkts","rx_bcast_pkts","rx_mcast_pkts"];return(t=t||{}).has_poe&&s.splice(2,0,"using_poe"),s=make_flex_table({container:t.container,row_num:!1,row_id_prefix:!0,selected_fields:s,default_sort:"port_num",columns:{port_num:{l:"Port",render:"[%= switch_details.render_port(item.port_num) %]",sort_by:"port_num"},using_poe:{l:"POE",render:"[%= item.using_poe ? 'in&nbsp;use' : '' %]"},tx_bytes:{l:"Sent bytes",render:"[%= render_bytes_field(item.tx_bytes) %]"},tx_pkts:{l:"Sent packets",render:"[%= render_packets_field(item.tx_pkts) %]"},tx_bcast_pkts:{l:"Sent broadcast packets",render:"[%= render_packets_field(item.tx_bcast_pkts) %]"},tx_mcast_pkts:{l:"Sent multicast packets",render:"[%= render_packets_field(item.tx_mcast_pkts) %]"},rx_bytes:{l:"Received bytes",render:"[%= render_bytes_field(item.rx_bytes) %]"},rx_pkts:{l:"Received packets",render:"[%= render_packets_field(item.rx_pkts) %]"},rx_bcast_pkts:{l:"Received broadcast packets",render:"[%= render_packets_field(item.rx_bcast_pkts) %]"},rx_mcast_pkts:{l:"Received multicast packets",render:"[%= render_packets_field(item.rx_mcast_pkts) %]"},status:{l:"Status",render:"[%= switch_details.render_status(item) %]"}},items:[],className:"compact fill"}),w(t.container).parent().hide(),w(t.container),s},e.render_port=function(t){return 0<t?t:"Total"},e.render_status=function(t){if(0===t.port_num)return"";var s=t.status;return e.uplink_port===t.port_num&&(s+=" - uplink"),s+=switch_details.render_error_flags(t)},e.render_error_flags=function(t){if(0===t.port_num)return"";var s=[];return 1&t.error_flags&&s.push("gigabit link failed"),0===s.length?"":" - <span class='switch_stats_error'>error: "+s.join(", ")+"</span>"},e.setup=function(){w("#status_mps a.mps_control").bind("click",function(t){w("#status_mps .more").toggle(w(this).hasClass("less")),w("#status_mps .less").toggle(w(this).hasClass("more"))}),w("#status_mps .less").hide(),w("#status_mps .more").show()},e.update_stats=function(t){var s=t;!node.switch_stack_id||(t.is_stack_master||(s=v,void 0!==k&&k.id==t.master_id||(void 0!==k&&x.stop(),k={name:t.master_name||t.master_mac,id:t.master_id},x=w.comet.node_subscribe("SwitchPortStats",function(t){v=t.data},k.id))));var e,r=t.ts;for(e in t.ports)if(t.ports.hasOwnProperty(e)){for(var o=t.ports[e],a=Mkijson.ports.hash[s3node.id+"_"+e],i=parseInt(e),n=["using_poe","power_consumption_mw","advertised_power_consumption_mw","total_millijoules_consumed","power_mode","sfp_eeprom","stp_flags","authd_user","curr_status","guest_vid","is_uplink"],p=["bytes","pkts","bcast_pkts","mcast_pkts"],d=0;d<n.length;d++)a[n[d]]=o[n[d]];void 0!==v&&(port_stp_flag=0,master_port_info=v.remote_ports[s3node.mac+"/"+e],master_port_info&&0<a.curr_status&&(a.stp_flags=master_port_info.stp_flags,master_port_info.lacp_disabled&&(a.curr_status|=switchport.STATUS_FLAGS.LACP_DISABLED)));for(d=0;d<p.length;d++){var l=p[d],m=a["live_"+l]=a["live_"+l]||[];(m=m||[]).push([r,o["tx_"+l],o["rx_"+l]]),5<m.length&&m.shift()}port_details.set_port_status(a,i,s3node)}var c,u,h,f=!1;(t.power_total||t.poe_uninit)&&(poe_options={container:"#status_poe",power_budget_mw:t.power_budget_mw,total_consumption_mw:t.power_total.power_consumption_mw,total_advertised_mw:t.power_total.advertised_power_consumption_mw,errors:{poe_unavail:t.poe_unavail,poe_uninit:t.poe_uninit,poe_disabled:t.poe_disabled}},f|=function(t){if(t){var s,e="";t.errors.poe_unavail||t.errors.poe_uninit?e="Unavailable":t.errors.poe_disabled?e="Disabled":(void 0===g&&void 0===t.total_consumption_mw||(s=void 0!==t.total_consumption_mw?t.total_consumption_mw:g,e+="Consumption: "+render_power_field(s)+" / "+render_power_field(t.power_budget_mw),g=s),void 0===b&&void 0===t.total_advertised_mw||(s=void 0!==t.total_advertised_mw?t.total_advertised_mw:b,e+=" <span class='dimtext'>(Budgeted: "+render_power_field(s)+" / "+render_power_field(t.power_budget_mw)+")</span>",b=s)),w(t.container).find("#poe_status_short").html(e);e="";return t.errors.poe_uninit?e=t.errors.poe_unavail||t.errors.poe_disabled?"All non-PoE power supplies must be removed or replaced with PoE power supplies, and then the switch must be rebooted.":"Please reboot the switch to initialize PoE.":(t.errors.poe_unavail||t.errors.poe_disabled)&&(e="All non-PoE power supplies must be removed or replaced with PoE power supplies."),w(t.container).find("#poe_status_ext").html(e).toggle(!!e),w(t.container).find("#poe_status_header").toggle(!e),t.errors.poe_unavail||t.errors.poe_disabled}}(poe_options),dashhelp("poe_status")),t.mps_status&&(f|=function(t){if(t&&t.mps_status&&2===t.mps_status.length){for(var s=0,e=0,r=[],o=w(t.container),_=0;_<t.mps_status.length;++_){var a,i=t.mps_status[_];a="powering"===i.state?(++e,"Online"):"connected"===i.state?(++s,"Offline"):"Empty";var n="<b>Slot "+(_+1)+": "+a+"</b>";"Offline"===a&&(n+="<span id='mps_status_"+_+"_header'></span>"),n+="<br>",i.serial&&(n+="Serial number: "+i.serial+"<br>"),i.model&&(n+="Model number: "+i.model+"<br>"),null!==i.max_power_poe&&void 0!==i.max_power_poe&&(n+="PoE budget: "+render_power_field(i.max_power_poe)+"<br>"),r.push(i.max_power_poe),o.find("#status_mps_"+_).html(n);n="";"Online"===a?n="good_mps":"Offline"===a?n="bad_mps":"Empty"===a&&(n="empty_mps"),o.find("#mps_slot_"+_).removeClass("good_mps bad_mps empty_mps").addClass(n)}var p=t.mps_mismatch,d="",l=t.mps_status.length-e-s;return d=2!==e||p?2===e?"Power supply models do not match, please investigate":1===e&&1===s?"A connected power supply is offline":1===e&&1==l?"Operating normally":"Operating in spite of power supplies":"Operating with redundant power",o.find("#status_mps_short span:first").html(d),o.find("span:first").html("").hide(),o.find("#status_mps_short").show(),0<s||p}}({container:"#status_mps",mps_status:t.mps_status,mps_mismatch:t.mps_mismatch}),dashhelp("mps_status_0"),dashhelp("mps_status_1")),t.rps_status&&(c={container:"#status_rps",rps_status:t.rps_status})&&(h="<span>","backing up"===(u=c.rps_status).state?h+="On redundant power":"available"===u.state?h+="Available":"not available"===u.state?h+="Unavailable":"offline"===u.state?h+="RPS system is off":"standby"===u.state?h+="Standby":h+="No RPS system connected",h+="</span>",w(c.container).html(h)),s&&s.stp_root_mac&&((h={container:"#status_stp",is_root:s.is_stp_root,is_root_stack:s.is_stp_root_stack,is_faulty:s.is_stp_root_faulty,priority:s.stp_root_priority}).is_root?h.is_root_stack&&(h.root_switch={name:s.stp_root_name||s.stp_root_mac,id:s.stp_root_id}):(h.root_switch={name:s.stp_root_name||s.stp_root_mac,id:s.stp_root_id},s.stp_root_aggr_ports?h.bridge_aggr_ports=s.stp_root_aggr_ports:(h.bridge_port=s.stp_root_port,s.stp_root_port_mac?h.stp_root_port_node={name:s.stp_root_port_node_name||s.stp_root_port_mac,id:s.stp_root_port_node_id}:k&&(h.stp_root_port_node=k),s.stp_bridge_mac&&(h.bridge_switch={name:s.stp_bridge_name||s.stp_bridge_mac,id:s.stp_bridge_id}))),function(e){if(e){var r="";e.is_faulty?w(e.container).html("Unavailable").parent().show():e.is_root?(e.is_root_stack?w(e.container).html("This "+link_for_stack(e.root_switch.id,"stack")):w(e.container).html("This switch")).parent().show():(e.root_switch.id?e.is_root_stack?r+=link_for_stack(e.root_switch.id,e.root_switch.name):r+=link_for_node(e.root_switch.id,e.root_switch.name):r+=e.root_switch.name,e.priority&&0<=parseInt(e.priority)&&(r+=" (priority "+e.priority+")"),e.bridge_aggr_ports?(r+=" <span class='dimtext'>via ",_.each(e.bridge_aggr_ports,function(t,s){1<e.bridge_aggr_ports.length&&s&&(r+=" <span class='dimtext'> ",r+=s<e.bridge_aggr_ports.length-1?" , ":" and "),t.node_id==s3node.id?r+="local ":r+=link_for_node(t.node_id,t.node_name||t.node_mac)+" ",r+="port</span> "+t.port})):e.stp_root_port_node&&e.stp_root_port_node.id!=s3node.id?r+=" <span class='dimtext'>via "+link_for_node(e.stp_root_port_node.id,e.stp_root_port_node.name)+" port</span> "+e.bridge_port:r+=" <span class='dimtext'>via port</span> "+e.bridge_port,e.bridge_switch&&(r+=" <span class='dimtext'>and</span> ",e.bridge_switch.id?r+=link_for_node(e.bridge_switch.id,e.bridge_switch.name):r+=e.bridge_switch.name),w(e.container).html(r).parent().show())}}(h)),y&&f&&w("#status_mps a.more").click(),y=!1,w(window).trigger("port_data_changed")},e}(jQuery);